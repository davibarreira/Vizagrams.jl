var documenterSearchIndex = {"docs":
[{"location":"tutorials/5_customization/#Customizing-Visualizations","page":"5 - Customizing Visualizations","title":"Customizing Visualizations","text":"","category":"section"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"Before we go into more details on how to construct complex visualizations, let us explain how one can customize the plots generated by Vizagrams specification.","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"using Vizagrams\nusing DataFrames\nusing Statistics\nusing Random\nusing VegaDatasets\ndf = DataFrame(dataset(\"cars\"));\n\n# We need to drop missing values, as Vizagrams does not handle them yet.\ndf = dropmissing(df);\nnothing #hide","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"When creating a plot in Vizagrams, many defaults are guessed in order to make the specification less verbose. Yet, if one wishes, it is possible to alter such deafults in order to produce custom visuals.","category":"page"},{"location":"tutorials/5_customization/#1.-Legends","page":"5 - Customizing Visualizations","title":"1. Legends","text":"","category":"section"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"When visualizations become more complex, so do their legends. Consider, for example, the scatter plot with faces as marks.","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"plt = Plot(\n    title=\"MyPlot\",\n    data=df,\n    encodings=(\n        x = (field = :Horsepower,),\n        y = (field = :Displacement,),\n        color = (field = :Origin, scale_range=:tableau_superfishel_stone),\n        smile = (field = :Cylinders, scale_range=(-1,1), legend=(fmark=x->Face(size=7,smile=x),)),\n    ),\n    graphic = ∑() do row\n        T(row[:x],row[:y])U(5)Face(headstyle=S(:fill=>row[:color]),smile=row[:smile])\n    end\n)\n\n\ndraw(plt, height=400)","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"When a user defines a new encoder, such as smile, by default, no legend will be drawn. If the user wants a legend, it is possible to specify a function, through the  fmark argument, which takes the values encoded and draws a mark. Another option is for users to draw the legends as a separate diagram, and incorporate it into the plot.","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"In the example above, we have used the fmark option. Let us now create a new customized legend.","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"plt = Plot(\n    title=\"MyPlot\",\n    data=df,\n    encodings=(\n        x = (field = :Horsepower,),\n        y = (field = :Displacement,),\n        color = (field = :Origin, scale_range=:tableau_superfishel_stone),\n        smile = (field = :Cylinders, scale_range=(-1,1)),\n    ),\n    graphic = ∑() do row\n        T(row[:x],row[:y])U(5)Face(headstyle=S(:fill=>row[:color]),smile=row[:smile])\n    end\n)\n\n\nlegend_title = S(:fontWeight => \"bold\")TextMark(fontfamily=\"Helvetica\",text=\"Smile\",fontsize=8)\nlegend_marks =\n        Face(smile=-1) ↓\n        (T(0,-0.4),TextMark(text=\"Cylinders = 3\",fontsize=0.6)) →\n        (T(2,0),TextMark(text=\"...\",fontsize=1)) →\n        (T(2,0),Face(smile=1) ↓\n        (T(0,-0.4),TextMark(text=\"Cylinders = 3\",fontsize=0.6)))\nlegend = legend_title ↓ (T(0,-10),U(8)legend_marks)\n\ndraw(plt + T(plt.config.figsize[1]+30,130)legend, height=400)","category":"page"},{"location":"tutorials/5_customization/#2.-Frames-and-Axes","page":"5 - Customizing Visualizations","title":"2. Frames and Axes","text":"","category":"section"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"Through the config argument in the graphic specification, users can thoroughly customize the frame and axes of plots.","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=>mean,:Miles_per_Gallon=>mean,:Cylinders=>median)\n\ngdf = sort(gdf,:Year)\n\nplt = Plot(\n    config=(\n            frame_style=S(:stroke=>:white),\n            xgrid = (;style=S(:strokeWidth=>30,:strokeOpacity=>0.05)),\n            xaxis=(\n                    title=\"years\",\n                    titleangle=π/2,\n                    titlefontsize=8,\n                    ticktextangle=π/2,\n                    ticktexts=collect(1970:1982),\n                    axisarrow=S(:stroke=>:red,:fill=>:red)Arrow(pts=[[0,0],[300,0]],headsize=5),\n            ),\n            ygrid=NilD(),\n            yaxis=(\n                    title=TextMark(text=\"Mean Horsepower\",fontsize=7,style= S(:fontWeight=>:bold), angle=π/2),\n                    ticktextangle=π/2,\n                    tickmark=T(2,0)Square(l=6),\n            ),\n        ),\n    data = gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n        size = (field = :Cylinders_median,),\n    ),\n    graphic = S(:opacity=>0.5,:stroke=>:black)Circle()\n)\n\ndraw(plt,height=400,pad=30)","category":"page"},{"location":"tutorials/5_customization/#3.-Titles","page":"5 - Customizing Visualizations","title":"3. Titles","text":"","category":"section"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"At last, we have the title of a plot. The simplest way to customize a title is to omit is from the graphic specification, and instead join it to the plot using the diagram opeartions.","category":"page"},{"location":"tutorials/5_customization/","page":"5 - Customizing Visualizations","title":"5 - Customizing Visualizations","text":"plt = Plot(\n    data=df,\n    encodings=(\n        x = (field = :Horsepower,),\n        y = (field = :Displacement,),\n        size = (field = :Cylinders,),\n    ),\n    graphic = S(:fill=>:steelblue,:opacity=>0.2,:stroke=>:black)Circle()\n)\n\nmaintitle = S(:fontWeight=>:bold)TextMark(text=\"Main Title\", anchor=:e,fontfamily=\"monospace\")\nsubtitle = S(:fontStyle=>:italic)TextMark(text=\"Subtitle\", anchor=:e, fontsize=8,fontfamily=\"monospace\")\n\ntitle = maintitle ↓ (T(0,-5),subtitle)\n\nd = plt ↑ title\n\ndraw(d, height=400)","category":"page"},{"location":"gallery/nightingale/#Nightingale's-Rose-Diagram","page":"Rose Diagram","title":"Nightingale's Rose Diagram","text":"","category":"section"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"This example recreates the famous rose diagram by Florence Nightingale. You can read about this plot here.","category":"page"},{"location":"gallery/nightingale/#1.-Importing-the-Data","page":"Rose Diagram","title":"1. Importing the Data","text":"","category":"section"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"Let us begin simply by importing the data into two dataframes. We have already adjusted the data for our plots.","category":"page"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"using Vizagrams\nusing DataFrames\nusing Random\nusing CSV\nusing Dates\n\npath = joinpath(pkgdir(Vizagrams), \"docs\", \"src\", \"assets\", \"nightingale1.csv\")\ndf1 = DataFrame(CSV.File(path));\npath = joinpath(pkgdir(Vizagrams), \"docs\", \"src\", \"assets\", \"nightingale2.csv\")\ndf2 = DataFrame(CSV.File(path));\n\nnothing #hide","category":"page"},{"location":"gallery/nightingale/#2.-Initial-Polar-Plot","page":"Rose Diagram","title":"2. Initial Polar Plot","text":"","category":"section"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"With the data adjusted, let us create a single plot in order to get a better sense for the final diagram.","category":"page"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"# The colors close to the original diagram\ncolors = [\"#93bee2ff\",\"#f2a4abff\",\"#808080ff\"]\n\nplt = Plot(\n    data=df1,\n    config=(\n        raxis=(angle=3π/4,tickvalues=[0,20,40,60,80,100]),\n        coordinate=:polar,\n        figsize=(300,300),\n        ),\n    encodings=(\n        r = (\n            field=:countsqr,\n            datatype=:q,\n            scale_domain =(0,100),),\n        angle = (\n            field=:month,\n            datatype=:n,\n            scale_domain = Dates.LOCALES[\"english\"].months,\n            ),\n        cause=(field=:order,scale=IdScale()),\n        color = (field=:cause,scale_range=colors),\n        date = (field=:datetime,scale=IdScale()),\n    ),\n    graphic = ∑(i=:date,orderby=:cause,descend=false) do rows\n        rmaj = cumsum(rows.r)\n        rmin = vcat(0,rmaj[begin:end-1])\n        ∑() do row\n            S(:fill=>row.color,:opacity=>1.0)*\n            Slice(rmajor=row.rmaj,rminor=row.rmin,θ=row.angle+π/2-π/12,ang=π/6)\n        end(hconcat(rows,rmaj=rmaj,rmin=rmin))\n    end\n);\n\ndraw(plt, height=500)","category":"page"},{"location":"gallery/nightingale/#3.-Rose-Diagram","page":"Rose Diagram","title":"3. Rose Diagram","text":"","category":"section"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"The plot above is very close to the original plot, but there are still some modifications we must do. For example, we must remove the axes, and write the months next to each slice. Since we want to create two rose diagrams, let us define a function that takes the data as input and produces our plot. The function is mostly just passing the plot complete specification with the data as an argument.","category":"page"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"function roseplot(data; title=\"\",legends=true, legend_transform=T(0,0))\n    if legends == false\n        legends = NilD()\n    else\n        legends = (;transform=legend_transform)\n    end\n    return Plot(\n        data=data,\n        title=T(0,100)TextMark(text=title, fontsize=8),\n        config=(\n            coordinate=:polar,\n            frame=NilD(),\n            grid=NilD(),\n            axes=NilD(),\n            legends=legends,\n            ),\n        encodings=(\n            r = (\n                field=:countsqr,\n                datatype=:q,\n                scale_domain =(0,100), scale_range=(1,150)),\n            angle = (\n                field=:month,\n                datatype=:n,\n                scale_domain = Dates.LOCALES[\"english\"].months,\n                scale_range = collect(range(0, -2π; length=12 + 1))[begin:(end-1)]\n                ),\n            month=(field=:month, datatype=:n,scale=IdScale()),\n            cause=(field=:order,scale=IdScale()),\n            color = (field=:cause,scale_range=colors),\n            date = (field=:datetime,scale=IdScale()),\n        ),\n        graphic = data->\n        R(-π/2)*∑(i=:date,orderby=:cause,descend=false) do rows\n            rmaj = cumsum(rows.r)\n            rmin = vcat(0,rmaj[begin:end-1])\n            slices = ∑() do row\n                S(:fill=>row.color,:opacity=>1.0)*\n                Slice(rmajor=row.rmaj,rminor=row.rmin,θ=row.angle-1.5π-π/12,ang=π/6)\n            end(hconcat(rows,rmaj=rmaj,rmin=rmin))\n    \n            r_text = max(rmaj[end]+5,50)\n            x = cos(rows.angle[1]) * r_text\n            y = sin(rows.angle[1]) * r_text\n            return slices +\n                   T(x,y)TextMark(text=rows.month[1],angle=rows.angle[1]-π/2,fontsize=4)\n        end(data)\n    );\nend","category":"page"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"With this function implemented, we can create the two diagrams.","category":"page"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"rose1 = roseplot(df1, title=\"April 1854 to March 1855\",legends=false)\nrose2 = roseplot(df2, title=\"April 1855 to March 1856\",\n                legends=true,legend_transform=T(-50,-90)U(0.7))\n\ndraw(rose2 + T(300,0)rose1,height=400,width=800)","category":"page"},{"location":"gallery/nightingale/#4.-Complete-Rose-Diagram","page":"Rose Diagram","title":"4. Complete Rose Diagram","text":"","category":"section"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"The previous diagram is very close to the original rose diagram, but we can make it even closer to the original. In the original, there is a line between each rose that is used to indicate where the first rose ends and the other begins. We can also add a title over the whole diagram. ","category":"page"},{"location":"gallery/nightingale/","page":"Rose Diagram","title":"Rose Diagram","text":"ang = -π/2 + π/12 + getscale(rose1,:angle)(\"April\")\nx = cos(ang)*90\ny = sin(ang)*90\n\nposrose1 = [x,y]\nposrose1 = T(300,0)(posrose1)\n\nang = -π/2 + π/12 + getscale(rose2,:angle)(\"April\")\nx = cos(ang)*60\ny = sin(ang)*60\nposrose2 = [x,y]\n\nl = S(:strokeDasharray=>5)Line([posrose1,[100,-50],posrose2])\nd = rose2 + T(300,0)rose1 + l\n\nmaintitle = TextMark(text=\"Diagram of the Causes of Mortality\",fontfamily=\"monospace\")\nsubtitle = TextMark(text=\"in the Army in the East\",fontfamily=\"monospace\")\ntitle = maintitle ↓ (T(0,-5),subtitle)\n\nd = d + T(0,150)acenter(d,title)*title\n\ndraw(d,height=400,width=800)","category":"page"},{"location":"gallery/moritz/#Replicating-OECD-Better-Life-Visualization","page":"OECD Better Life Index","title":"Replicating OECD Better Life Visualization","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"In this notebook, we show how Vizagrams can be use to produce the OECD Better Life visualization.","category":"page"},{"location":"gallery/moritz/#1.-Creating-Petal","page":"OECD Better Life Index","title":"1. Creating Petal","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"We start by creating the Petal mark.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"using Vizagrams\nimport Vizagrams: ζ, θ;\n\nusing DataFrames\nusing CSV\nusing ColorSchemes\nusing Colors\nusing Statistics\nimport Random\n\n# Creating a colorscheme\nrainbow_12 = ColorScheme(colourschemes[:rainbow][reverse(vcat(1:2:17,2,8,14))]);\n\nstruct Petal <: Mark\n    height::Real\n    width::Real\n    color::String\nend\n\n# Default Petal\nPetal(;height=1, width=0.5, color=\"steelblue\") = Petal(height, width,color)\n\nfunction θ(p::Petal)\n    (;height, width, color) = p\n    return η([\n                Prim(CBezierPolygon(\n                    [[0,0],[0,height],[0,0]],\n                    [[-width,height*0.8],[0,height],[0,height],[width,height*0.8],[0,0],[0,0]]),\n                S(:fill=>color, :strokeWidth=>0))\n            ])\nend\ndraw(Petal())","category":"page"},{"location":"gallery/moritz/#2.-Creating-Flower","page":"OECD Better Life Index","title":"2. Creating Flower","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"The next step is to use the Petal to create the Flower. This is done by passing the respective heights, widths and colors for each petal. The flower is then produced by rotating each petal accordingly.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"struct Flower <: Mark\n    heights::Vector{Real}\n    widths::Vector{Real}\n    colors::Vector{String}\nend\n\nfunction ζ(flower::Flower)\n    (;heights, widths, colors) = flower\n    numberpetals = length(heights)\n    angles = range(0,2π,numberpetals+1)[begin:end-1]\n    reduce(+,map(x->R(-x[1])* Petal(x[2],x[3],x[4]),\n            zip(angles,heights, widths, colors)))\nend\n\n\nRandom.seed!(4)\nnpetals = 8\nheights = rand(npetals);\nwidths = heights * 0.35\ncolors = map(x->\"#\"*hex(get(colourschemes[:rainbow], rand())),1:npetals)\nflower = Flower(heights, widths,colors)\n\ndraw(flower)","category":"page"},{"location":"gallery/moritz/#3.-Creating-Stem","page":"OECD Better Life Index","title":"3. Creating Stem","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"The Stem consisting in a vertical bar together with a text.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"struct Stem <: Mark\n    height::Real\n    text::String\nend\n\nfunction ζ(stem::Stem)\n    (;height, text) = stem\n    stem_bar = T(0,height) * T(0,-height)Bar(h=height,w=0.05)\n\n    t = TextMark(text=text,angle=π/2,fontsize=7)\n    textbox = U(1.2)rectboundingbox(t,S(:fill=>:white)) + t\n    textbox = U(0.05) * textbox\n    textbox = amiddle(stem_bar,textbox)*textbox\n    return stem_bar + textbox\nend\nstem_height = 5\nstem_text = \"Text\"\n\nstem = Stem(stem_height, stem_text)\ndraw(stem)","category":"page"},{"location":"gallery/moritz/#4.-Creating-Plant","page":"OECD Better Life Index","title":"4. Creating Plant","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"With the Flower and Stem, we can create the Plant mark as shown in the OECD Better Life Index visualization.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"struct Plant <: Mark\n    flower_heights::Vector{Real}\n    flower_widths::Vector{Real}\n    flower_colors::Vector{String}\n    stem_height::Real\n    stem_text::String\nend\nPlant(;flower_heights, flower_widths, flower_colors, stem_height, stem_text) = Plant(flower_heights, flower_widths, flower_colors, stem_height, stem_text)\n\nfunction ζ(plant::Plant)\n    (;flower_heights, flower_widths, flower_colors, stem_height, stem_text) = plant\n\n    flower = Flower(flower_heights, flower_widths, flower_colors)\n    stem = Stem(stem_height, stem_text)\n    d = stem + T(0,stem_height) * flower\nend\n\nstem_height = 5\nstem_text = \"Text\"\nplant = Plant(heights, widths, colors, stem_height, stem_text)\n\ndraw(plant)","category":"page"},{"location":"gallery/moritz/#5.-Making-the-Plot","page":"OECD Better Life Index","title":"5. Making the Plot","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"We use the OECD Better Life Index found at https://stats.oecd.org/Index.aspx?DataSetCode=BLI.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"First, let us fix the dataset. We are using the OECD Better Life Index, the one used by Moritz. The original dataset is not in the proper format for the visualization. We need to do some transformations in order to get something more similar to the data used by Moritz.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"Thus, we do some data normalization in order to compute the indexes for each topic. We do not claim that index values we compute are the actual correct indexes. But this does not matter to us, as our goal is just to replicate the visualization, not the dataset.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"path = joinpath(pkgdir(Vizagrams), \"docs\", \"src\", \"assets\", \"oecd.csv\")\ndf = DataFrame(CSV.File(path));\ndf[!,:BLI_Index] = map(x->split(x,\"_\")[1], df.INDICATOR)\n\ndf = leftjoin(df,combine(groupby(df, :Indicator), :Value => maximum, :Value=> minimum), on=:Indicator)\ndf[!,:Norm_Value] = map(row->(row[:Value] - row[:Value_minimum])/(row[:Value_maximum] - row[:Value_minimum]),eachrow(df))\ndf = combine(groupby(df,[:Country,:BLI_Index]),:Norm_Value=>mean)\ndf = rename(df,:BLI_Index => :Topic, :Norm_Value_mean => :Value)\ndf = leftjoin(df,combine(groupby(df,:Country),:Value=>sum),on=:Country)\ndf = filter(row->row[:Country]!=\"OECD - Total\",df)\ndf[!,:Country] = map(x->x == \"Korea\" ? \"South Korea\" : x ,df.Country)\ndf[!,:Country] = map(x->x == \"Türkiye\" ? \"Turkey\" : x ,df.Country)\ndf[!,:Country] = map(x->x == \"Slovak Republic\" ? \"Slovakia\" : x ,df.Country);\nnothing #hide","category":"page"},{"location":"gallery/moritz/#5.1-Scatter-Plot","page":"OECD Better Life Index","title":"5.1 Scatter Plot","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"We start with a simple scatter plot.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"scatter_plt = Plot(\n    title=\"Scatter Plot\",\n    figsize=(1000,200),\n    data=df,\n    config=(\n        xaxis=(title=\"Countries\", ticktextangle=π/2),\n        yaxis=(title=\"Value in Topics\",),\n        ),\n    encodings=(\n        x = (field = :Country, datatype = :n),\n        y = (field = :Value, datatype = :q),\n        color = (field = :Topic, datatype=:n,scale_domain=unique(df.Topic),scale_range=rainbow_12),\n    ),\n    graphic = ∑(row->begin\n            T(row[:x],row[:y])*S(:fill=>row[:color],:opacity=>0.8)*Circle(r=3)\n        end)\n);\n\ndraw(scatter_plt, width=800)","category":"page"},{"location":"gallery/moritz/#5.2-Flower-Plot","page":"OECD Better Life Index","title":"5.2 Flower Plot","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"Next, we use the Flower mark as a nested plot that aggregates the values in the same country.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"flowerplt = Plot(\n    title=\"MyPlot\",\n    figsize=(1000,200),\n    data=df,\n    config=(\n        xaxis=(title=\"Countries\", ticktextangle=π/2),\n        yaxis=(title=\"Value in Topics\",),\n        ),\n    encodings=(\n        x = (field = :Country, datatype = :n),\n        y = (field = :Value_sum, datatype = :q),\n        color = (field = :Topic, datatype=:n,scale_domain=unique(df.Topic),scale_range=rainbow_12),\n        h = (field=:Value, datatype=:q, scale=IdScale()),\n    ),\n    graphic= ∑(i=:x,orderby=:x, row-> begin\n                T(first(row.:x),first(row.:y))U(20)Flower(row.h, 0.30*row.h,row.color)\n            end\n            )\n);\n\ndraw(flowerplt,width=800)","category":"page"},{"location":"gallery/moritz/#5.3-Plant-Plot","page":"OECD Better Life Index","title":"5.3 Plant Plot","text":"","category":"section"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"We finish with the OECD Better Index Plot using our Plant mark.","category":"page"},{"location":"gallery/moritz/","page":"OECD Better Life Index","title":"OECD Better Life Index","text":"plt = Plot(\n        figsize=(1000,200),\n        data=df,\n        config=(\n            frame=NilD(),\n            grid=NilD(),\n            xaxis=(ticktexts=\"\",tickmark=NilD()),\n            yaxis=(axisarrow=NilD(),title=\"\"),\n            ),\n        encodings=(\n            x = (field = :Country, datatype = :n),\n            y = (field = :Value_sum, datatype = :q, scale_domain=(0,8)),\n            color = (field = :Topic, datatype=:n,scale_domain=unique(df.Topic),scale_range=rainbow_12),\n            h = (field=:Value, datatype=:q, scale=IdScale(),),\n            text=(field=:Country,datatype=:n, scale=IdScale()),\n        ),\n        graphic = ∑(i=:x, rows-> begin\n                    T(rows.:x[1],0) * U(20)*\n                    Plant(\n                        flower_heights=rows.h,\n                        flower_widths =0.30rows.h,\n                        flower_colors=rows.color,\n                        stem_height=rows.y[1]/20,\n                        stem_text=rows.text[1]\n                    )\n            end)\n    )\ndraw(plt,width=800)","category":"page"},{"location":"gallery/histogram/#Histogram","page":"Histogram","title":"Histogram","text":"","category":"section"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"A histogram is simply a bar plot. We only need to precompute some characteristics such as the bins and the amount in each bin. Vizagrams already has some helper functions to compute bins as well as a histogram mark Hist. Let us start by producing a histogram using the presets in Vizagrams, and then we show how to do it all manually.","category":"page"},{"location":"gallery/histogram/#1.-Creating-a-Histogram-Quickly","page":"Histogram","title":"1. Creating a Histogram Quickly","text":"","category":"section"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"Here is the quickest way of creating a histogram. We use the functions bindata that bins the data, and countbin which returns the weights for the bins for each value. We then use the Hist() mark.","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"using Vizagrams\nusing Random\nusing StatsBase\nusing StructArrays\n\nRandom.seed!(4)\ndata = StructArray(x=rand(100),)\nhist = Plot(\n    data=data,\n    x=bindata(data.x),\n    y=countbin(data.x),\n    graphic=Hist()\n)\n\ndraw(hist)","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"We can also add some text on top of each bar:","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"hist = Plot(\n    data=data,\n    x=bindata(data.x),\n    y=countbin(data.x),\n    h=(value=countbin(data.x),scale=IdScale()),\n    graphic= Hist() + ∑(i=:x) do row\n        T(row.x[1],row.y[1]+10)TextMark(text=row.h[1],fontsize=8)\n    end\n)\n\ndraw(hist)","category":"page"},{"location":"gallery/histogram/#2.-Histogram-Graphic-Expression","page":"Histogram","title":"2. Histogram Graphic Expression","text":"","category":"section"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"Let us now show how we can draw the histogram using only bars.","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"hist = Plot(\n    data = data,\n    config=(;\n        grid=NilD(),\n        xaxis=(;title=\"Histogram\"),\n        yaxis=(;title=\"Count\"),\n    ),\n    encodings=(\n        x=(value=bindata(data.x,nbins=5),),\n        y=(value=countbin(data.x,nbins=5),datatype=:q),\n    ),\n    graphic = data-> begin\n\n        # compute the bin width\n        w = let\n            u = sort(unique(data.x))\n            u[2]-u[1]-1\n        end\n\n        # draw each bar\n        ∑(i=:x) do row\n                S(:fillOpacity=>0.9,:fill=>:steelblue)*\n                T(row.x[1],0)Bar(w=w,h=row.y[1],orientation=:v)\n        end(data)\n    end\n)\n\ndraw(hist)","category":"page"},{"location":"gallery/histogram/#3.-Computing-the-Histogram-Manually","page":"Histogram","title":"3. Computing the Histogram Manually","text":"","category":"section"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"Next, let us compute the histogram bins manually and draw them.","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"Random.seed!(4)\n# Create a histogram\nh = fit(Histogram, rand(100), nbins=10)\n\n# Get the edges of the bins\nedges = h.edges[1]\n\n# Compute the centers of the bins\nbin_centers = (edges[1:end-1] .+ edges[2:end]) ./ 2\n\ndata = StructArray(x=bin_centers, h=h.weights)\n\nhist = Plot(\n    data = data,\n    config=(;xaxis=(;tickvalues=collect(h.edges[1])),),\n    encodings=(\n        x=(field=:x,datatype=:q,guide=(tickvalues=collect(h.edges[1]),)),\n        y=(field=:h,datatype=:q),\n    ),\n    graphic = data->begin\n        bar_width = (data.x[2] - data.x[1])*0.95\n        ∑() do row\n            T(row[:x],0)*\n            S(:fillOpacity=>0.9,:fill=>:steelblue)*\n            Bar(w=bar_width,h=row[:y])\n        end(data)\n    end\n)\n\ndraw(hist)","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"The benefit of having the complete specification is that we can modify it in order to customize our visualization. For example, we can remove the y-axis and add the values above the bars.","category":"page"},{"location":"gallery/histogram/","page":"Histogram","title":"Histogram","text":"hist2 = Plot(\n    config =(\n        frame=NilD(),\n        yaxis=NilD(),\n        grid=NilD(),\n    ),\n    data = data,\n    encodings=(\n        x=(field=:x,datatype=:q),\n        y=(field=:h,datatype=:q),\n        h=(field=:h,datatype=:q,scale=IdScale(),),\n    ),\n    graphic = sdata->begin\n        w = (sdata.x[2] - sdata.x[1])*0.95\n        ∑() do row\n            T(row[:x],0)*\n            S(:fillOpacity=>0.9,:fill=>:steelblue)*\n            (\n                Bar(w=w,h=row[:y]) ↑\n                (T(0,4),TextMark(fontsize=14,text=row[:h]))\n            )\n        end(sdata)\n    end\n)\n\ndraw(hist2)","category":"page"},{"location":"tutorials/1_basics/#Basics-of-Diagram-Drawing","page":"1 - Diagramming Basics","title":"Basics of Diagram Drawing","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"In this tutorial, we show how Vizagrams can be used to produce diagrams. We start from a simple example, and gradually present more complex examples.","category":"page"},{"location":"tutorials/1_basics/#1.-Drawing-a-simple-diagram","page":"1 - Diagramming Basics","title":"1. Drawing a simple diagram","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"The basic building blocks for any diagram are graphical marks and graphical transformations. We can think of graphical marks as graphical objects that can be drawn in the screen, while the graphical transformations are actions such as translations, rotations, change of color, and so on. Vizagrams provides some ready to use marks, but users can define their own marks, yet, we leave this topic to another tutorial.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"Let us start with a very simple example:","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"using Vizagrams\n# My first Diagram\nd = Circle()\n\ndraw(d)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"In the code above, we simply define a diagram d as containing a Circle. Note that this circle has a default radius of 1 and center [0,0]. By calling draw(d), we turn the diagram d into an SVG file, which can then be rendered by the browser. Note that the draw also scales the drawing to fit a specific height. In this case, the default height is 500. We can pass another height in order to get either a smaller or larger diagram, or we can use a pad to apply some padding to the output SVG.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = Circle()\ndraw(d,height=100, pad=20)","category":"page"},{"location":"tutorials/1_basics/#2.-Applying-Transformations","page":"1 - Diagramming Basics","title":"2. Applying Transformations","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"Graphical transformations can be either geometric or aesthetic. The geometric transformations are translations (T(x,y)), rotations (R(θ)), uniform scaling (U(s)), and reflection (M(p)). For aesthetic (stylistic) transformations, we use S(attr), where attr is something like :fill=>:red, which will apply the fill color of red.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"The way we apply transformations follows a mathematical notation. We use * to represent the action of applying a transformation to a mark. Moreover, we can compose transformations also using * or by simply stacking transformations side by side. Let us do some examples to clarify.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = Square()\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = R(π/4)*Square()\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = S(:fill=>:red,:stroke=>:blue,:strokeWidth=>2)*Square()\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = S(:fill=>:red,:stroke=>:blue,:strokeWidth=>2)R(π/4)*Square()\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/#3.-Combining-Marks-for-more-complex-Diagrams","page":"1 - Diagramming Basics","title":"3. Combining Marks for more complex Diagrams","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"A diagram with a single graphical mark is not very interesting. We can construct more complex diagrams by \"adding\" marks together. The process of adding marks is akin to drawing a mark one on top of the other, similar to how in an SVG file we write the tag for a different geometry one after another.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = S(:fill=>:blue)Circle() + S(:fill=>:red)RegularPolygon(n=3) +S(:fill=>:green)Square()\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"We now have the tools to create very complex diagrams, it is just a matter of adding marks and applying transformations.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = T(3,0)Circle() + T(0,2)RegularPolygon(n=3) +R(π/10)U(2)Square()\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"Note also that our * operator is distributive, hence, we can apply the same transformations to several marks at once.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = S(:fill=>:blue)*(T(3,0)Circle() + T(0,2)RegularPolygon(n=3) +\n    R(π/10)U(2)Square()) +\n    T(2,-2)S(:stroke=>:red,:strokeWidth=>5)Line([[0,0],[3,0],[3,3]])\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/#4.-Combining-Diagrams","page":"1 - Diagramming Basics","title":"4. Combining Diagrams","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"We can combine marks and apply transformations. Similarly, we can combine previously created diagrams to create new diagrams.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d1 = Circle() + T(2,0)*Circle()\nd2 = S(:fill=>:blue)*(T(3,0)Circle() + T(0,2)RegularPolygon(n=3) +R(π/10)U(2)Square())\nd  = d1 + T(5,0)R(π/5)*d2\n\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/#5.-Stacking-Diagrams","page":"1 - Diagramming Basics","title":"5. Stacking Diagrams","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"The basic geometric transformations are translations, rotations, reflections, and scaling. Yet, Vizagrams provides some stacking transformations to ease the process of diagram drawing. The process of stacking consists in placing two marks one right next to the other given a certain direction. This is done by computing the envelope (similar to bounding box) of each mark, and then translating the marks accordingly.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = Circle() → Circle() ↑ Square()\n\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"We can add some spacing between the stacking by passing a tuple containing the mark and a translation transformation.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = Circle() → (T(0.5,0),Circle() → (T(0.5,0),Circle()))\n\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"One has to pay attention to the parenthesis, as the order matters. Yet, we can use mapping functions to reduce the clutter. For example, let us stack several circles side by side with a 0.5 spacing.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = mapreduce(c->Circle(), (x,y)-> x → (T(0.5,0),y), 1:5)\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/#6.-Text-and-LaTeX","page":"1 - Diagramming Basics","title":"6. Text and LaTeX","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"Text is also a mark. Hence, we can apply geometric and aesthetic transformations.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"d = S(:fontFamily=>\"Futura\")TextMark(text=\"My Text\",anchor=:c,fontsize=1)\n\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"Let is alter the anchor values to show how it behaves. We draw a cross around the center of the canvas, in order to make clear how the text moves.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"cross = Line([[-3,0],[3,0]]) + R(π/2)Line([[-3,0],[3,0]])\n\nanchors = [:c, :s, :n, :e, :w, :se, :sw, :ne, :nw]\nd = mapreduce(a ->cross + TextMark(text=uppercase(\"$a\"),anchor=a,fontsize=1),\n    (x,y)-> x → (T(0.5,0),y),anchors)\n\ndraw(d,height=80)","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"Vizagrams also provides the possibility of writing LaTeX. For this, the user must import LaTeXStrings:","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"using LaTeXStrings\nd = S(:fill=>:blue)*\n    TextMark(text=L\"e^x = \\sum^\\infty_{i=0}\\frac{x^n}{n!} = 1 + x + \\frac{x^2}{2} + \\cdots\")\ndraw(d,height=100)","category":"page"},{"location":"tutorials/1_basics/#6.-A-Final-Example","page":"1 - Diagramming Basics","title":"6. A Final Example","text":"","category":"section"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"We end this tutorial with a fractal diagram.","category":"page"},{"location":"tutorials/1_basics/","page":"1 - Diagramming Basics","title":"1 - Diagramming Basics","text":"function sierpinski(n)\n    if n == 0\n        return Polygon([(1,0), (0,0), (1/2, 1)])\n    else\n        t = sierpinski(n - 1)\n        return U(0.5) * (T(-1/2,0)t + T(0,1)t + T(1/2,0)t)\n    end\nend\n\nd = sierpinski(5)\ndraw(d)","category":"page"},{"location":"gallery/floatingbar/#The-Chart-Missing-From-ALL-Spreadsheet-Software","page":"Floating Stacked Bar","title":"The Chart Missing From ALL Spreadsheet Software","text":"","category":"section"},{"location":"gallery/floatingbar/","page":"Floating Stacked Bar","title":"Floating Stacked Bar","text":"This example is inspired in the video (https://www.youtube.com/watch?v=5zBg9pH_6bE) by the Minute Physics channel. The idea is to used floating stacked bars to represent data such as temperature ranges. Check the video for a discussion on this specific visualization.","category":"page"},{"location":"gallery/floatingbar/","page":"Floating Stacked Bar","title":"Floating Stacked Bar","text":"using Vizagrams\nusing DataFrames\nusing CSV\npath = joinpath(pkgdir(Vizagrams), \"docs\", \"src\", \"assets\", \"weather.csv\")\ndf = DataFrame(CSV.File(path))","category":"page"},{"location":"gallery/floatingbar/","page":"Floating Stacked Bar","title":"Floating Stacked Bar","text":"Once we import the data, we must transform the dataframe such that each row contains a pair of temperature values for a given range.","category":"page"},{"location":"gallery/floatingbar/","page":"Floating Stacked Bar","title":"Floating Stacked Bar","text":"df = stack(df, [:Ontario, :England, :Kentucky], variable_name=:location, value_name=:value)\n\ncoalg_pairwise(lst) = [(lst[i],lst[i+1]) for i in 1:length(lst)-1]\ndf = combine(groupby(df,:location)) do gdf\n    hcat(\n        DataFrame(coalg_pairwise(gdf[!,:Column1]),[:low,:high]),\n        DataFrame(coalg_pairwise(gdf[!,:value]),[:l,:h])\n    )\n    \nend\ndf[!,:low_high] = df[!,:low] .* \"_\" .* df[!,:high]\ndf","category":"page"},{"location":"gallery/floatingbar/","page":"Floating Stacked Bar","title":"Floating Stacked Bar","text":"We can now use Vizagrams to express the graphic.","category":"page"},{"location":"gallery/floatingbar/","page":"Floating Stacked Bar","title":"Floating Stacked Bar","text":"plt = Plot(\n    config = (;yaxis=(;title=\"Temperature (°C)\")),\n    data=df,\n    x = :location,\n    y = (field=:h,scale_domain=(-10,40), scale_range=(0,200)),\n    low_y = (field=:l,scale_domain=(-10,40), scale_range=(0,200)),\n    color = (field=:low_high,scale_range=[\"#F28E2B\",\"#4E79A7\",\"#FFBE7D\",\"#A0CBE8\"]),\n    graphic = ∑(i=:x) do rows\n        ∑() do row\n            S(:fill=>row.color,:stroke=>:white)*\n            Trail([[row.x,row.low_y],[row.x,row.y]],20)\n        end(rows)\n    end\n)\n\ndraw(plt, height=400)","category":"page"},{"location":"tutorials/3_datavisualization/#Basics-of-Data-Visualization","page":"3 - Data Vizualization Basics","title":"Basics of Data Visualization","text":"","category":"section"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Vizagrams is more than a diagram drawing package, it is also a tool for data visualization. The main idea is to integrate diagramming with data visualization, hence increasing the kind of visualizations we can express. This integration is made possible mainly due to the way graphical marks are coded.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"The way Vizagrams defines graphical marks allows us to create marks such as axes, grids, legends, and so on, which help us assemble a plot. All these elements are used by a more general mark called Plot. The parameters used to create an instance of Plot is what we call a graphic specification.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Vizagrams is a visualization grammar in the sense that it provides a graphic specification. Moreover, the specification follows the specification style of Vega-Lite, with some slight modifications. If you know Vega-Lite, the way Vizagrams defines plots will be very familiar to you. Yet, for those that are not used to visualization grammars, Vizagrams also provides some quick functions to produce plots.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"using Vizagrams\nusing DataFrames\nusing Statistics\nusing Random","category":"page"},{"location":"tutorials/3_datavisualization/#1.-First-Data-Visualization","page":"3 - Data Vizualization Basics","title":"1. First Data Visualization","text":"","category":"section"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"We start with a very simple example. We generate some random values, and then create a plot using the function, you guessed it, plot. This function is just a quick way to specify a plot without having to write the whole specification.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Random.seed!(4)\nplt = plot(x=rand(10),y=rand(10))\ndraw(plt,height=300)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"We have a plot. More interestingly, the plt object is a diagram, thus, we can manipulate and compose with other marks.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"d1 = plt↑S(:fontWeight => :bold)TextMark(; text=\"This is my plot\", anchor=:e, fontsize=14)\nd2 =\n    R(π / 5) * (\n        plt↑(\n            S(:fontWeight => :bold) *\n            TextMark(; text=\"This is my plot rotated\", anchor=:e, fontsize=14)\n        )\n    )\n\nd = d1 → (T(50, 0), d2)\ndraw(d)","category":"page"},{"location":"tutorials/3_datavisualization/#2.-Graphic-Specification","page":"3 - Data Vizualization Basics","title":"2. Graphic Specification","text":"","category":"section"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"For more control over a data visualization, one can use a graphic specification. A specification is a description of the plot, which contains information such as how to map the data to the visual variables, which type of graphical marks one must use, how to scale the data, and so on. As we have stated, Vizagrams follows the specification style from Vega-Lite.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"First, let us import a dataframe to be visualized.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"using VegaDatasets\ndf = DataFrame(dataset(\"cars\"));\n\n# We need to drop missing values, as Vizagrams does not handle them yet.\ndf = dropmissing(df);\nnothing # hide","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"plt = Plot(\n    data=df,\n    encodings=(\n        x=(field=:Horsepower,),\n        y=(field=:Miles_per_Gallon,),\n        color=(field=:Origin,)\n    ),\n    graphic=Circle(r=5)\n)\ndraw(plt)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Note that in the example above, Vizagrams tries to infer the proper scaling and axes for the given plot based on the underlying data. For example, Vizgrams is guessing that both :Horsepower and :Miles_per_Gallon are quantitative data, while :Origin is nominal.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Users can provide more parameters to the graphic specifcation in order to get a graphic closer to ones preferences. For example, besides data, encoding and graphic, one can use parameters such as title, figsize and config.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Below we increment the previous plot with more parameters:","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"p = Plot(\n    title=\"Plot\",\n    figsize=(500,300),\n    config=(\n        xgrid=(flag=true,),\n        ygrid=(flag=true,)\n        ),\n    data=df,\n    encodings=(\n        x=(field=:Horsepower,datatype=:q),\n        y=(field=:Miles_per_Gallon,),\n        color=(field=:Acceleration,scale_range=(:red,:blue)),\n        size = (field = :Cylinders,datatype=:o, scale_range=(1,3)),\n    ),\n    graphic=S(:stroke=>:black)Circle(r=3)\n)\n\ndraw(p, height=300)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Let us explore a bit of our specification:","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"p = Plot(\n    title=\"Plot\",\n    figsize=(300,300),\n    config=(\n        xgrid=(flag=true,),\n        ygrid=(flag=true,)\n        ),\n    data=df,\n    encodings=(\n        x=(field=:Horsepower,datatype=:q),\n        y=(field=:Miles_per_Gallon,),\n        color=(field=:Acceleration,scale_range=(:red,:blue)),\n        size = (field = :Cylinders,datatype=:o, scale_range=(1,3)),\n    ),\n    graphic=S(:stroke=>:black)Circle(r=3)\n)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"The main fields we have here are title, figsize, config, data, encodings, and graphic.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"title is title above the plot;\nfigsize is pixel size for frame containing the graphic;\nconfig is","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"for extra attributes for manipulating aesthetic aspects of the plot, such as grids, axes style, and so on'","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"data is picking the dataset;\nencodings is mapping the visual variables (positions x y, and","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"color) to the data columns (x goes to:Horsepower,ygoes to:MilesperGallonandcolorgoes to:Field`);","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"graphic is defininig how to draw the graphic inside the plotting context.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"All these parameters are somewhat the same as in Vega-Lite, with the exception of graphic.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"In Vega-Lite and other visualization grammars (e.g. ggplot), instead of this field graphic they have a field mark or geom (stands for geometry). Their role is very similar to what we have called graphic in the sense that they describe the sort of \"graphical mark\" to be drawn in the plotting frame. Yet, as will be shown further, graphic contains what is called graphic expression, which are functions that map a set of data to a diagram.","category":"page"},{"location":"tutorials/3_datavisualization/#3.-More-Examples","page":"3 - Data Vizualization Basics","title":"3. More Examples","text":"","category":"section"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"We end this tutorial presenting some more examples. We do not dive into the extra capabilities of the graphic parameter in this tutorial.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=>mean,:Miles_per_Gallon=>mean)\n\nplt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n    ),\n    graphic= S(:strokeWidth=>4)Line()\n)\ndraw(plt)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"If we want to draw the points over the line, we can just add the circles.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"plt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n    ),\n    graphic= S(:strokeWidth=>4)Line() + S(:opacity=>1)Square(l=10)\n)\ndraw(plt)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"Vizagrams also has default behavior for marks such as bars.","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=>mean,:Miles_per_Gallon=>mean)\n\nplt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n    ),\n    graphic= S(:fill=>:steelblue)Bar(w=20)\n)\ndraw(plt)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=>mean,:Miles_per_Gallon=>mean)\n\nplt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,scale_domain=(0,400)),\n        color=(field=:Origin,),\n    ),\n    graphic= S(:stroke=>:black)Bar(w=20)\n)\ndraw(plt)","category":"page"},{"location":"tutorials/3_datavisualization/","page":"3 - Data Vizualization Basics","title":"3 - Data Vizualization Basics","text":"disasters = DataFrame(dataset(\"disasters\"))\ndisasters = dropmissing(disasters);\ndisasters = filter(Cols(:Entity)=>x->x!=\"All natural disasters\", disasters);\n\nplt = Plot(\n    title=\"Disasters\",\n    config = (\n        grid=NilD(),\n        ),\n    figsize=(500,400),\n    data=disasters,\n    encodings=(\n        x = (field = :Year, datatype = :q, scale_domain=(1900,2017)),\n        y = (field = :Entity,datatype=:n, scale_domain=unique(sort(disasters.Entity, rev=true))),\n        color = (field = :Entity,legend=(flag=false,)),\n        size = (field = :Deaths,datatype=:q, scale_domain =(0,maximum(disasters.Deaths)), scale_range=(2,30))\n    ),\n    graphic = S(:stroke=>:black,:opacity=>0.8)Circle()\n)\n\ndraw(plt, height=500)","category":"page"},{"location":"tutorials/2_custommarks/#Working-with-Graphical-Marks","page":"2 - Custom Marks","title":"Working with Graphical Marks","text":"","category":"section"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"In Vizagrams, every drawing is, in final analysis, just a collection of graphical primitives. These primitives are geometric shapes such as circles, lines, polygons, and so on. A graphical mark is a subtype of the abstract type Mark for which there exists a function that turns it into a diagram, in other words, a mark is a data type which we can represent as a diagram.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"Note that, according to this definition, every primitive shape is itself a mark, since the output diagram is just itself. Hence, when we define a diagram using primitives, this is equivalent to using marks.","category":"page"},{"location":"tutorials/2_custommarks/#1.-Introducing-Existing-Marks","page":"2 - Custom Marks","title":"1. Introducing Existing Marks","text":"","category":"section"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"Vizagrams already comes with several graphical marks ready to use. Some of these graphical marks are just the primitive geometric shapes such as circles, lines, polygons, Bezier curves, while others are more complex, such as arrows, faces, and so on.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"Let us start by listing all the available marks that come with Vizagrams. Some of them are used internally, hence one does not need to worry about it.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"using Vizagrams\nusing InteractiveUtils\nsubtypes(Mark)","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"Note that many of the existing marks involve data visualization components, such as ticks, axes, legend and so on. We are not going to use them now, as our goal is not to introduce the data visualization aspects of Vizagram. Let us instead start with some simpler examples:","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"d = Arrow()\n\ndraw(d, height=100)","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"When we draw an instance of Arrow, we are drawing a line together with a triangle. The advantage of encapsulating into a mark is that we can specify how to parametrize this mark in order to get the desired behavior. This becomes clearer in the next example:","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"d = Face() →\n    Face(eyestyle=S(:fill=>:red)) →\n    Face(smile=1) →\n    Face(smilestyle=S(:strokeDasharray=>2),smile=-1) →\n    Face(headstyle=S(:fill=>:grey))\ndraw(d, height=100)","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"Note that the mark Face has parameters that allows us to modify some of its features, but not everything. The overall \"shape\" of the face is kept.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"We can combine different marks in the same diagram.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"angles = 0:π/10:π\nd = Face(smile=0.5) +\n    mapreduce(a->R(a)Arrow(pts=[[1,0],[2,0]],headsize=a/10),+, angles) +\n    S(:fill=>:grey)T(0,-1.5)*Rectangle(h=1,w=2)\n\ndraw(d,height=200)","category":"page"},{"location":"tutorials/2_custommarks/#2.-Creating-Custom-Marks","page":"2 - Custom Marks","title":"2. Creating Custom Marks","text":"","category":"section"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"Besides the marks provided in Vizagrams, users can create their own marks and use them to create diagrams. The process of mark creation can be divided in two steps. First, the user must create a new data type and make it a subtype of Mark, which is the abstract type provided by Vizagrams. Secondly, the user must define a method for the generic function ζ (\\zeta). This ζ method is the one responsible for turning the new mark into a diagram.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"import Vizagrams: ζ\n\nstruct Tree <: Mark\n    h #parameter that specifies the height of the tree\nend\nTree(;h=2) = Tree(h)\n\n# Specifying how to draw a tree\nfunction ζ(tree::Tree)\n    # grabbing the height for the tree\n    height = tree.h\n\n    # defining a diagram for the trunk\n    trunk = S(:fill=>:brown)T(0,height/2)*Rectangle(h=height,w=0.5)\n\n    # drawing the leaves\n    angles = collect(0:0.7:2π)\n    leaves = S(:fill=>:green)*(\n        Circle(r=0.5)+\n        mapreduce(x->T(cos(x)*(0.5),sin(x)*(0.5))Circle(r=0.3),+,angles)\n        )\n\n    # combining the trunk and the leaves to draw the tree\n    return trunk + T(0,height)leaves\nend\n\nd = Tree(h=2) → Tree(h=4)\ndraw(d)","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"The power of creating marks is that we can now use them to create other marks. Hence, we can gradually increase the complexity of our marks. Let us use our tree mark to define a forest.","category":"page"},{"location":"tutorials/2_custommarks/","page":"2 - Custom Marks","title":"2 - Custom Marks","text":"using Random\n\nstruct Forest <: Mark\n    n\nend\n\nForest(;n=2) = Forest(n)\nfunction ζ(m::Forest)\n    Random.seed!(4)\n    n = m.n\n    pos = 2 .* rand(n,2).-1\n    pos = pos[sortperm(pos[:,2],rev=true),:]\n    trees = mapreduce(x->T(x...)U(0.1)*Tree(),+, eachrow(pos))\n    return trees+S(:fillOpacity=>0.1)*(Square(l=2.5))\n\nend\n\ndraw(Forest(50))","category":"page"},{"location":"gallery/boxplot/#BoxPlot","page":"BoxPlot","title":"BoxPlot","text":"","category":"section"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"A BoxPlot is a graphical mark used to represent the distribution of a collection of data. Vizagrams already implements the BoxPlot mark, yet, we use this example to show how one could recreate it without having to relying on the implementation provided.","category":"page"},{"location":"gallery/boxplot/#1.-Creating-the-BoxPlot-Mark","page":"BoxPlot","title":"1. Creating the BoxPlot Mark","text":"","category":"section"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"The first step is to create the graphical mark.","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"struct BoxPlot <: Mark\n    data\n    box_width::Real\nend\nBoxPlot(;data=[-3,-1,0,1,4],box_width=1) = BoxPlot(data,box_width)\n\nfunction Vizagrams.ζ(boxplot::BoxPlot)\n    (;data, box_width) = boxplot\n\n    # Computing Statistics\n    m = median(data)\n    q1=quantile(data,0.25)\n    q3=quantile(data,0.75)\n    iqr = q3 - q1\n    li = max(q1 - 1.5*iqr,minimum(data))\n    ls = min(q3 + 1.5*iqr,maximum(data))\n\n\n    # Drawing box elements\n    boxbottom = T(0,m)T(0,-(m-q1)/2)Rectangle(h=m-q1,w=box_width)\n    boxtop = T(0,m)T(0,(q3-m)/2)Rectangle(h=q3-m,w=box_width)\n    linetop    = S(:strokeWidth=>1)*Line([[0,q3],[0,ls]])\n    linebottom = S(:strokeWidth=>1)*Line([[0,q1],[0,li]])\n    linem = S(:strokeWidth=>2,:stroke=>:white)*Line([[-box_width/2,m],[box_width/2,m]])\n    return boxtop + boxbottom + linem + linetop + linebottom\nend","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"By creating the struct and defining the ζ method, we have specifyied the bare minimum for the creation of a graphical mark.","category":"page"},{"location":"gallery/boxplot/#2.-Plot-Specification-using-BoxPlot","page":"BoxPlot","title":"2. Plot Specification using BoxPlot","text":"","category":"section"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"Next, let us actually plot using the BoxPlot mark.","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"using Vizagrams\nusing DataFrames\nusing PalmerPenguins\ndf = DataFrame(PalmerPenguins.load())\ndf = dropmissing(df);\n\nplt = plot(df,x=:species,color=:species,y=:body_mass_g,\n    graphic=∑(i=:x) do rows\n        S(:fill=>rows.color[1])T(rows.x[1],0)BoxPlot(data=rows.y,box_width=40)\n    end\n)\ndraw(plt)","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"We can reduce the graphic specification by passing a function that defines the graphic expression for the given mark:","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"function GraphicExpression(box::BoxPlot)\n    return ∑(; i=:x) do rows\n        S(:fill => rows.color[1])T(rows.x[1], 0)BoxPlot(; data=rows.y, box_width=40)\n    end\nend","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"Once this is done, we can do the previous boxplot by simply writing:","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"plt = plot(df,x=:species,color=:species,y=:body_mass_g,\n    graphic=BoxPlot()\n)\ndraw(plt)","category":"page"},{"location":"gallery/boxplot/#3.-Altering-Axis","page":"BoxPlot","title":"3. Altering Axis","text":"","category":"section"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"At last, note that we can change the axis of our boxplot by altering the graphic expression:","category":"page"},{"location":"gallery/boxplot/","page":"BoxPlot","title":"BoxPlot","text":"plt = plot(df,y=:species,color=:species,x=:body_mass_g,\n    graphic=∑(i=:y) do rows\n        S(:fill=>rows.color[1])T(0,rows.y[1])R(-π/2)BoxPlot(data=rows.x,box_width=40)\n    end\n)\n\ndraw(plt)","category":"page"},{"location":"tutorials/7_composite/#Composite-Visualizations","page":"7 - Composite Visualizations","title":"Composite Visualizations","text":"","category":"section"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Composite visualizations are those that combine distinct plots to form a single visualization. A simple example of this are subplots, where one stacks plots together either vertically or horizontally. There are several ways to produce composite plots. Let us explore how to do them using Vizagrams.","category":"page"},{"location":"tutorials/7_composite/#1.-Facet-Plots","page":"7 - Composite Visualizations","title":"1. Facet Plots","text":"","category":"section"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Facet plots are those where the data is broken into distinct columns. In Vizagrams, this kind of plot can be done in different ways. One way consists in using the plot specification with another plot specification inside. The second way involves grouping the data and then combining the plots using the diagramming operations.","category":"page"},{"location":"tutorials/7_composite/#1.1-Facet-Plot-via-Diagramming","page":"7 - Composite Visualizations","title":"1.1 Facet Plot via Diagramming","text":"","category":"section"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Let us start with the diagramming way.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"using Vizagrams\nusing StatsBase\nusing DataFrames\nusing Random\nusing VegaDatasets\n\ndf = DataFrame(dataset(\"cars\"));\ndf[!,:Year] = map(x->parse(Int,x[3:4]),df.Year)\ndf = dropmissing(df);\n\nfacet = ∑(i=:Origin,op=→) do gdf\n    Plot(\n        title=gdf.Origin[1],\n        config=(;legends=NilD()),\n        data=gdf,\n        x=(field=:Horsepower,scale_domain=(40,250)),\n        y=(field=:Miles_per_Gallon,scale_domain=(0,50)),\n    )\nend(df)\n\ndraw(facet,width=800)","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Note that, in the code above, we are using the ∑ operator to group the dataset df using the column Origin. Once the dataset is grouped, we create a plot. Then, each plot is combined using the beside operator →.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"One might wish to apply different colors to each plot. This can be done by creating a scale function, as shown next:","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"colorscale = infer_scale(data=df.Origin, variable=:color)\nfacet = ∑(i=:Origin,op=→) do gdf\n    Plot(\n        title=gdf.Origin[1],\n        config=(;legends=NilD()),\n        data=gdf,\n        x=(field=:Horsepower,scale_domain=(40,250)),\n        y=(field=:Miles_per_Gallon,scale_domain=(0,50)),\n        color=(value=row->colorscale(row.Origin),scale=IdScale()),\n    )\nend(df)\n\ndraw(facet,width=800)","category":"page"},{"location":"tutorials/7_composite/#1.2-Facet-Plot-via-Plot-Specification","page":"7 - Composite Visualizations","title":"1.2 Facet Plot via Plot Specification","text":"","category":"section"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"It is also possible to create a facet plot using a plot specification.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"facet = Plot(\n    config=(\n        figsize=(300,200),\n        coordinate=nothing,\n        frame=NilD(),\n        legends=(;transform=T(1030,200)),\n        ),\n    data=df,\n    x=(field=:Horsepower,scale=IdScale()),\n    y=(field=:Miles_per_Gallon,scale=IdScale()),\n    color=(field=:Origin,),\n    origin=(field=:Origin,scale=IdScale()),\n\n    graphic= data->begin\n        ∑(i=:color,op=(x,y)->x→(T(10,0),y)) do gdf\n            Plot(\n                title=gdf.origin[1],\n                config=(legends=NilD(),xaxis=(;title=\"\")),\n                data=gdf,\n                x=(field=:x,scale_domain=(0,250)),\n                y=(field=:y,scale_domain=(0,50)),\n                color=(field=:color,scale=IdScale()))\n        end(data)↓(T(0,-10),TextMark(text=\"Horsepower\",pos=[150,0]))\n    end\n)\ndraw(facet,width=800)","category":"page"},{"location":"tutorials/7_composite/#2.-Nesting","page":"7 - Composite Visualizations","title":"2. Nesting","text":"","category":"section"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Nested visualizations are those where we place a plot inside another plot. In a sense, we can think of the previous facet plots as a nested visualization, as can be more clearly seen in the example using a single plot specification.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Let us start with a common example. We do a pizza plot nested inside a scatter plot.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"plt = Plot(\n    data=df,\n    figsize=(500,300),\n    x=(field=:Year,scale_domain=(68,84)),\n    y=:Cylinders,\n    color = (field=:Origin,datatype=:n,),\n    angle = (field=:Origin, scale=IdScale()),\n    size = (field=:Acceleration, scale_range=(2.0,20)),\n    graphic= ∑(i=:x,∑(i=:y) do rows\n            acc = mean(rows.size)\n            countvalues = sort(countmap(rows.color))\n            colors = collect(keys(countvalues))\n            angles = 2π.*values(countvalues)./length(rows.angle)\n            T(rows.x[1],rows.y[1])U(acc)*\n            Pizza(angles=angles,colors=colors,style=S(:strokeWidth=>0.5))\n    end)\n)\n\ndraw(plt)","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Next, we do a more complex example, showcasing the customization capabilities.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"plt = Plot(\n    config=(;\n        figsize=(400,170),\n        frame=NilD(),\n        xaxis=(;axisarrow=NilD(),tickmark=NilD()),\n        yaxis=(;axisarrow=NilD(),tickmark=S(:opacity=>0)Circle(r=2),ticktextangle=π/2),\n        xgrid=NilD(),\n        ygrid=(;style=S(:strokeWidth=>48,:vectorEffect=>\"none\",:strokeOpacity=>0.03)),\n        legends=(;transform=T(420,120)U(0.5))\n        ),\n    data=df,\n    x=(field=:Cylinders),\n    y=(field=:Origin),\n    color=(field=:Acceleration,),\n    horsepower=(field=:Horsepower,scale=IdScale()),\n    miles=(field=:Miles_per_Gallon,scale=IdScale()),\n    cylinder=(field=:Cylinders,scale=IdScale(),datatype=:o),\n    origin=(field=:Origin,scale=IdScale()),\n\n    graphic=\n        ∑(i=:cylinder,orderby=:cylinder,descend=true,\n            ∑(i=:origin,orderby=:origin,) do gdf\n                T(gdf.x[1],gdf.y[1])*\n            centralize_graphic(U(0.19)*\n                Plot(\n                    config=(\n                        frame_style=S(:fill=>:white,:fillOpacity=>1.0,),\n                        legends=NilD(),\n                        yaxis=(;title=\"\"),\n                        xaxis=(;title=\"\")),\n                    data=gdf,\n                    x=(field=:horsepower,scale_domain=(0,250)),\n                    y=(field=:miles,scale_domain=(0,50)),\n                    color=(field=:color,scale=IdScale())\n            ))\n            end\n    )\n)\ndraw(plt,width=800)","category":"page"},{"location":"tutorials/7_composite/#3.-Integrated","page":"7 - Composite Visualizations","title":"3. Integrated","text":"","category":"section"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Integrated visualizations are those where distinct plots are somehow integrated. A common example of this would be parallel coordinate plots. The difficulty in creating such visualizations involves having to coordinate distict scales in order.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Our example is inspired in one of the visualizations presented in the paper \"Dece: Decision explorer with counterfactual explanations for machine learning models\" (2020, Cheng, Furui and Ming, Yao and Qu, Huamin).","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Let us start by creating a dataset.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Random.seed!(4)\ntoefl = 10randn(100) .+ 300\nrating = 10randn(100) .+ 100\nscore = 5rand(100) .+ 5;\naccept = rand([0,0,1],100);\ndf = DataFrame(:toefl=>toefl,:rating=>rating,:score=>score,:accept=>accept);\nnothing #hide","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Next, we create a horizontal bar plot:","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"plt_accept = Plot(\n    title = \"Acceptance\",\n    config=(;grid=NilD(),\n        xaxis=(;title=\"count\"),\n        yaxis=(;title=\"\"),\n        ),\n    data=df,\n    x=(value=row->sum(df.accept .== row.accept),scale_domain=(0,70)),\n    y=:accept,\n    graphic=∑(i=:y) do rows\n        S(:fill=>:steelblue)T(0,rows.y[1])Bar(w=rows.x[1],h=50,orientation=:h)\n    end\n)\ndraw(plt_accept)","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Our goal next is to create histograms for the other variables and stack them horizontally. For this, we define a function tohist to envelope our histogram specification.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"function tohist(data, title)\n    Plot(\n        title = title,\n        config=(;\n            grid=NilD(),\n            xaxis=(;title=\"count\"),\n            yaxis=(;tickvalues=bin_edges(data),title=\"\"),\n            ),\n        y = bindata(data),\n        x = (value=countbin(data),scale_domain=(0,maximum(countbin(data))+2)),\n\n        graphic = data-> begin\n        # compute the bin width\n        w = let\n            u = sort(unique(data.y))\n            u[2]-u[1]-1\n        end\n\n        # draw each bar\n        ∑(i=:y) do row\n                S(:fillOpacity=>0.9,:fill=>:steelblue)*\n                T(0,row.y[1])Bar(h=w,w=row.x[1],orientation=:h)\n        end(data)\n    end\n    )\nend\n\ndata = [toefl,rating,score]\nplts = map(x->tohist(x[1],x[2]),zip(data,[\"TOEFL\",\"RATING\",\"SCORE\"]));\nplts = vcat(plts,plt_accept)\nplt = reduce((x,y)->x→(T(10,0),y),plts);\n\ndraw(plt,width=800)","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"Up until now, this visualization is simply a sort of facet plot. The next step is to draw lines accross this plot in order to illustrate how a single observed row varies accross these different dimensions.","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"gs = getmarkpath(Plot,plt,G)\nlines = mapreduce(+,1:10) do i\n    pts = map(zip(plts,[:toefl,:rating,:score,:accept],gs)) do row\n        y = getscale(row[1],:y)(df[i,row[2]])\n        pos = row[3]([0.0,y])\n        pos = row[3]([0.0,y])\n    end\n    S(:stroke=>:orange)Line(pts)\nend\n\nd = plt + lines\ndraw(d,width=800)","category":"page"},{"location":"tutorials/7_composite/","page":"7 - Composite Visualizations","title":"7 - Composite Visualizations","text":"To draw the lines we must obtain the position in each axis and apply the same translation as used in each plot. To do this, we must do two things. First, we must get the scale in each plot, and apply it to the y value in our lines. Secondly, we must get how much each plot is translated left, and use this in the x value. The first task is done using the getscale function, while the second is done using the getmarkpath function.","category":"page"},{"location":"gallery/penguins/#Penguins-Plot","page":"Penguins","title":"Penguins Plot","text":"","category":"section"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"Let us explore how customized marks can be used in data visualization within Vizagrams. For this, we will use the famous Palmer Penguins dataset.","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"using Vizagrams\nusing PalmerPenguins\nusing DataFrames\nusing Statistics\n\ndf = DataFrame(PalmerPenguins.load())\ndf = dropmissing(df);\nnothing #hide","category":"page"},{"location":"gallery/penguins/#1.-Creating-our-Penguin-Mark","page":"Penguins","title":"1. Creating our Penguin Mark","text":"","category":"section"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"First, we create a penguin mark.","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"struct PenguinBill <: Mark\n    bill_length::Real\n    bill_depth::Real\nend\nPenguinBill(;bill_length=40, bill_depth=20) = PenguinBill(bill_length, bill_depth)\n\nfunction Vizagrams.ζ(p::PenguinBill)::TMark\n    (;bill_depth, bill_length) = p\n    bill = R(-π/2)U(1/30)Polygon([[-bill_depth,0],[0,bill_length],[bill_depth,0]])\n    bill = S(:fill=>:orange)T(0.5,0)*bill\n    splash = T(-0.2,0)*QBezierPolygon([[0.2,0],[1,0]],[[1.,1],[0.5,-1]])\n    splash = R(π/4)T(-0.1,0.1)S(:fill=>:white)*splash\n    eye = T(0.3,0.3)S(:fill=>:orange)Circle(r=0.1) + T(0.3,0.3)Circle(r=0.05)\n    return bill + Circle() + splash + eye\nend\n\ndraw(PenguinBill(),height=200)","category":"page"},{"location":"gallery/penguins/#2.-A-Simple-Plot","page":"Penguins","title":"2. A Simple Plot","text":"","category":"section"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"We start with a simple plot:","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"plt = plot(df,x=:island,y=:species,graphic = PenguinBill())\ndraw(plt)","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"The mark is too small and has transparency. Let us fix it:","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"plt = plot(df;\n    x=:island,\n    y=:species,\n    graphic=Mark(\n        U(20)S(:opacity => 1)PenguinBill())\n)\ndraw(plt)","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"This plot is not making use of the parameters specified in the penguin mark. Let us use them:","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"plt = plot(df,\n    x=:island,\n    y=:species,\n    color=:species,\n    bill_length= (field=:bill_length_mm,scale=IdScale()),\n    bill_depth= (field=:bill_depth_mm,scale=IdScale()),\n    graphic= ∑(i=:x, ∑(i=:y) do row\n        T(row.x[1],row.y[1])U(20)*\n        S(:fill=>row.color[1])*\n        PenguinBill(\n            bill_length=median(row.bill_length),\n            bill_depth=median(row.bill_depth)\n        )\n    end)\n)\ndraw(plt)","category":"page"},{"location":"gallery/penguins/#3.-More-Complex-Example","page":"Penguins","title":"3. More Complex Example","text":"","category":"section"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"Our previous plot compared penguins in terms of bill length and depth for different species in different islands. We can modify the specification in order to also compare penguins in terms of sex.","category":"page"},{"location":"gallery/penguins/","page":"Penguins","title":"Penguins","text":"plt = plot(df,\n    x=:island,\n    y=:species,\n    sex=(field=:sex,scale=IdScale()),\n    color=:species,\n    bill_length= (field=:bill_length_mm,scale_range=[10,100],),\n    bill_depth= (field=:bill_depth_mm,scale_range=[10,30]),\n    \n    graphic= ∑(i=:x, ∑(i=:y,orderby=:sex, descend=true, ∑(i=:sex,op=↑) do row\n                T(0,-10)*\n                T(row.x[1],row.y[1])U(10)*\n                S(:fill=>row.color[1])*\n                (\n                    PenguinBill(bill_length=median(row.bill_length),bill_depth=median(row.bill_depth))\n                    ←\n                    (T(-0.5,0),S(:fill=>:grey)TextMark(text=row.sex[1],fontsize=0.7,fontfamily=\"monospace\"))\n                )\n    end\n    ))\n)\ndraw(plt,height=500)","category":"page"},{"location":"gallery/minard/#Minard's-Chart","page":"Minard's Chart","title":"Minard's Chart","text":"","category":"section"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"In this example, we reproduce Minard’s depiction of Napoleon’s march on Russia. The visualization can be broken down in two subplots. The first contains a Trail plot with the number of troops marching, and the second is the temperature variation.","category":"page"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"First, we create the marching plot, and then draw the text labels over the plot.","category":"page"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"using Vizagrams\n\n# Importing the dataset\nusing RDatasets\ntroops = RDatasets.dataset(\"HistData\", \"Minard.troops\")\ntemp = RDatasets.dataset(\"HistData\", \"Minard.temp\")\ncities = RDatasets.dataset(\"HistData\", \"Minard.cities\");\n\n\n# Create the Plot\nplt = Plot(\n    title=\"Minard\",\n    config=(\n        xaxis=NilD(),\n        yaxis=(titleangle=π/2,),\n    ),\n    figsize=(1000,300),\n    data=troops,\n    encodings=(\n        x = (field = :Long,),\n        y = (field = :Lat,scale_domain=(53.8,56)),\n        color = (field = :Direction, datatype=:n, scale_range=[\"#bd9e39\",:gray]),\n        detail = (field = :Group, datatype=:n),\n        size = (field=:Survivors, scale_range=(1,10)),\n    ),\n    graphic = ∑(i=:detail,∑(i=:color) do row\n        S(:fill=>row.color[1])Trail(pts=row.x ⊗ row.y,ws=row.size)\n    end)\n)\n\n\ncities_graphic = ∑() do row\n    T(plt(row,:Long,:x),plt(row,:Lat,:y))*TextMark(text=row.City)\nend(cities);\n\ndraw(plt + cities_graphic, height=nothing, width=800)","category":"page"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"Next, we produce the temperature plot.","category":"page"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"plt_temp = Plot(\n    figsize=(1000,100),\n    config = (\n        ygrid=NilD(),\n        xaxis=(title=\"Logitude\",),\n        yaxis=(title=\"Temperature\",titleangle=π/2),\n        ),\n    data=temp,\n    encodings=(\n        x = (field = :Long,scale = getscale(plt,:x)),\n        y = (field = :Temp,),\n    ),\n    graphic = S(:stroke=>:black)Line() + S(:fill=>:black, :opacity=>1)Square(l=10)\n)\n\ndraw(plt_temp, height=nothing, width=800)","category":"page"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"Finally, the full visualization.","category":"page"},{"location":"gallery/minard/","page":"Minard's Chart","title":"Minard's Chart","text":"draw((plt + cities_graphic) ↓ plt_temp, height=nothing, width=800)","category":"page"},{"location":"gallery/pca/#PCA-Plot","page":"PCA","title":"PCA Plot","text":"","category":"section"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"This visualization is present in the \"Scientific Visualization: Python + Matplotlib\" (Nicolas P. Rougier, Bordeaux, November 2021) book.","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"It consists in fitting a PCA line through the data, and then drawing the error histogram for such PCA.","category":"page"},{"location":"gallery/pca/#1.-Generating-the-Data-and-Computing-the-PCA","page":"PCA","title":"1. Generating the Data and Computing the PCA","text":"","category":"section"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"We start creating a dataset by sampling a multivariate normal distribution. After that, we apply the PCA.","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"using Vizagrams\nusing Distributions\nusing Random\nusing MultivariateStats\nusing DataFrames\n\n# Generate data from Multivariate Normal\ndist = MvNormal([0,0],[1 0.5; 0.5 1.0])\nRandom.seed!(4)\nsamples = rand(dist,100)\nx = samples[1,:]\ny = samples[2,:];\n\n# Perform PCA\nM = fit(PCA, samples; maxoutdim = 1)\ntransformed_data = MultivariateStats.transform(M, samples)\nlsample = reconstruct(M,[-3.,3.0]')\n\n# M = fit(PCA, samples; maxoutdim=2)\nsamples_pca = reconstruct(M, transformed_data)\npca_x = samples_pca[1,:]\npca_y = samples_pca[2,:];\n\n# DataFrame\ndf = DataFrame(x=x,y=y,pca_x=pca_x,pca_y=pca_y);\ndf[!,:err] = map(row->sign(row[:y]-row[:pca_y])√((row[:x]-row[:pca_x])^2 + (row[:y]-row[:pca_y])^2),eachrow(df));\n\n# PCA Equation\nlsample = reconstruct(M,[-0.,1.0]')\nx1 = lsample[1,1]\ny1 = lsample[2,1]\nx2 = lsample[1,2]\ny2 = lsample[2,2]\nα = (y1-y2)/(x1-x2)\nβ = y1 - α*x1\n\npcaeq(x) = α*x + β","category":"page"},{"location":"gallery/pca/#2.-Creating-the-Plots","page":"PCA","title":"2. Creating the Plots","text":"","category":"section"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"Next, let us create our two main plots that compose the visualization. We have a scatter plot showing the data:","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"plt = Plot(\n    config =(\n        frame_style=S(:strokeWidth=>0),\n        grid=NilD(),\n    ),\n    data = df,\n    x=:x,\n    y=:y,\n    graphic = S(:fill=>:steelblue,:opacity=>0.8,:strokeOpacity=>1,:stroke=>:white)Circle(r=3)\n)\n\ndraw(plt)","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"Next, we draw the PCA line passing through the data.","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"lx = [-2.8,4.0]\nly = pcaeq.(lx)\nline_pca = S(:stroke=>:grey,:strokeWidth=>2,:strokeDasharray=>5)Line(getscale(plt,:x)(lx),getscale(plt,:y)(ly))\n\nplt_line = plt + line_pca\ndraw(plt_line)","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"The other plot is the histogram for the error around the PCA fit.","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"hist = Plot(\n    data=df,\n    config=(;\n        grid=NilD(),\n        xaxis=(;ticktexts=\"\",title=\"\"),\n        yaxis=NilD(),\n        frame=NilD(),\n        ),\n    x=bindata(df.err),\n    y=countbin(df.err),\n    h=(value=countbin(df.err),scale=IdScale(),),\n    graphic = Hist() + ∑(i=:x) do rows\n        S(:fill=>:steelblue)T(rows.x[1],rows.y[1]+10)TextMark(text=rows.h[1])\n    end\n)\n\ndraw(hist)","category":"page"},{"location":"gallery/pca/#3.-Combinig-the-Plots","page":"PCA","title":"3. Combinig the Plots","text":"","category":"section"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"Our final visualization consists in placing the histogram inside the scatter plot. To do so, we must scale the histogram so that its size matches the scale in the scatter plot. Moreover, we need to rotate and translate the histogram. The rotation angle is the angle for the PCA line, while the translation should be a value large enough so the histogram falls outside the points in the scatter plot.","category":"page"},{"location":"gallery/pca/","page":"PCA","title":"PCA","text":"# Compute the maximum error from the PCA line\nmaxerr = findmax(identity,abs.(df.err))[2]\nerror_width = getscale(plt,:y)(pcaeq(df[maxerr,:x])) - getscale(plt,:y)(df[maxerr,:y])\n\n# Compute the PCA angle\nΔx = getscale(plt,:x)(lx)[2] - getscale(plt,:x)(lx)[1]\nΔy = getscale(plt,:y)(ly)[2] - getscale(plt,:y)(ly)[1]\nang = atan(Δy/Δx)\n\n# Compute the histogram pixel size\nhbb= boundingwidth(hist)/2\n\n# Compute the scaling factor so that the histogram\n# width matches the error_width width\nrel = cos(ang)*error_width/hbb\n\n# Compute where to place the histogram\npx = 2.5\npy = pcaeq.(px)\npx = getscale(plt,:x)(px)\npy = getscale(plt,:y)(py)\n\nviz = plt_line + T(px,py)R(-π/2 + ang)U(rel)T(-hbb,0)hist\n\ndraw(viz, height=500)","category":"page"},{"location":"gallery/groupedbar/#Grouped-Bar-Chart","page":"Grouped Bar Chart","title":"Grouped Bar Chart","text":"","category":"section"},{"location":"gallery/groupedbar/","page":"Grouped Bar Chart","title":"Grouped Bar Chart","text":"In this example, we produce the grouped bar chart. We start with the bar chart in the x axis direction.","category":"page"},{"location":"gallery/groupedbar/","page":"Grouped Bar Chart","title":"Grouped Bar Chart","text":"using Vizagrams\nusing DataFrames\n\ndf = DataFrame(\n    :category => [\"A\", \"A\", \"A\", \"B\", \"B\", \"B\", \"C\", \"C\", \"C\"],\n    :group => [\"x\", \"y\", \"z\", \"x\", \"y\", \"z\", \"x\", \"y\", \"z\"],\n    :value => [0.1, 0.6, 0.9, 0.7, 0.2, 1.1, 0.6, 0.1, 0.2]\n);\n\n\nplt = Plot(\n    data=df,\n    encodings=(\n        x=(field=:category,),\n        y=(field=:value,),\n        color=(field=:group,datatype=:n),\n    ),\n    graphic =\n        ∑(i=:x,op=+,\n            ∑(i=:color,op=→,orderby=:color, descend=false,\n                data-> begin\n                w = 20\n                bars = ∑() do row\n                    S(:fill=>row[:color])Bar(h=row[:y],c=[row[:x],0], w = w)\n                end(data)\n                total_width = boundingwidth(bars)\n                T(-total_width/2-w/2,0)bars\n            end\n            )\n        )\n)\n\ndraw(plt)","category":"page"},{"location":"gallery/groupedbar/","page":"Grouped Bar Chart","title":"Grouped Bar Chart","text":"With some small modifications, we can produce the grouped bar chart in the y axis.","category":"page"},{"location":"gallery/groupedbar/","page":"Grouped Bar Chart","title":"Grouped Bar Chart","text":"plt = Plot(\n    data=df,\n    figsize=(400,300),\n    encodings=(\n        x=(field=:value,),\n        y=(field=:category,),\n        color=(field=:group,datatype=:n),\n    ),\n    graphic =\n        ∑(i=:y,op=+,\n            ∑(i=:color,op=↑,orderby=:color, descend=false,\n                data-> begin\n                w = 20\n                bars = ∑() do row\n                    S(:fill=>row[:color])T(0,row[:y])R(-π/2)Bar(h=row[:x], w = w)\n                end(data)\n                total_height = boundingheight(bars)\n                T(0,-total_height/2-w/2)bars\n            end\n            )\n        )\n)\ndraw(plt)","category":"page"},{"location":"","page":"Home","title":"Home","text":"CurrentModule = Vizagrams","category":"page"},{"location":"#Vizagrams","page":"Home","title":"Vizagrams","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Vizagrams is a visualization framework that integrates diagramming and data visualization, with the goal of providing high expressiveness with intuitive usability.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The framework implements a diagramming DSL together with a visualization grammar, thus allowing users to create diagrams by combining and transforming plots, as well as to create new visualization specifications using diagram construction operations.","category":"page"},{"location":"","page":"Home","title":"Home","text":"","category":"page"},{"location":"#Why-another-visualization-package?","page":"Home","title":"Why another visualization package?","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"The moto for Vizagrams is \"high expressiveness with intuitive usability.\" In other words, the goal is for users to be able to produce (complex) visualizations without having to become power-users or resorting to ad-hoc methods, where the complexity is hidden by several lines of code. To achieve this, Vizagrams uses a novel approach to data visualization construction, which integrates graphic specification and diagramming.","category":"page"},{"location":"","page":"Home","title":"Home","text":"The framework implements a diagramming DSL, and builds a visualization grammar on top of it. The idea of constructing data visualization tools on top of diagramming frameworks is not new[1]. What makes Vizagrams distinct is how it uses the concepts of graphical marks and graphic expressions[2] to blur the distinction between data visualization and diagramming. This allows users to produce plots and manipulate them using diagramming operations such as composition, translation, rotation, style transformations, and so on.","category":"page"},{"location":"","page":"Home","title":"Home","text":"One of the core assumptions of Vizagrams is that once users understand the basics of the framework, the task of creating new visualizations becomes similar to diagramming, hence the \"intuitive usability.\" In terms of \"expressiveness,\" we let the gallery of examples speak for itself.","category":"page"},{"location":"#Package-Features","page":"Home","title":"Package Features","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Here is a summary of the features provided by Vizagrams:","category":"page"},{"location":"","page":"Home","title":"Home","text":"Diagramming DSL inspired by the Haskell library Diagrams;\nVisualization grammar with syntax similar to Vega-Lite;\nAbility to define custom graphical marks;\nAbility to use graphic expressions to create new data visualization specifications;\nManipulate and combine plots using diagramming operations;","category":"page"},{"location":"#Quickstart","page":"Home","title":"Quickstart","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Let us do some simple examples to illustrate how to use Vizagrams. We start with a simple diagram:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using Vizagrams\n\nd = Circle() + T(2,0)*Square()\ndraw(d)","category":"page"},{"location":"","page":"Home","title":"Home","text":"Note that + represents composition, and T(2,0) is translation. Besides translations, we have rotation (R(ang)), uniform scaling (U(x)), mirror reflection (M(ang)), and stylistic transformations (S(...)). Let us increment our previous diagram:","category":"page"},{"location":"","page":"Home","title":"Home","text":"d = S(:fill=>:white,:stroke=>:black)*Circle(r=2) + d\ndraw(d)","category":"page"},{"location":"","page":"Home","title":"Home","text":"For plotting, we use the visualization grammar syntax. If you have used VegaLite.jl, this might look familiar:","category":"page"},{"location":"","page":"Home","title":"Home","text":"using DataFrames\nusing VegaDatasets\ndf = DataFrame(dataset(\"cars\"));\ndf = dropmissing(df);\n\nplt = Plot(\n    data=df,\n    encodings=(\n        x=(field=:Horsepower,),\n        y=(field=:Miles_per_Gallon,),\n        color=(field=:Origin,)\n    ),\n    graphic=Circle(r=5)\n)\ndraw(plt)","category":"page"},{"location":"","page":"Home","title":"Home","text":"We can use our diagram d as a mark for a new plot:","category":"page"},{"location":"","page":"Home","title":"Home","text":"new_plt = Plot(\n    data=df,\n    encodings=(\n        x=(field=:Horsepower,),\n        y=(field=:Miles_per_Gallon,),\n        color=(field=:Origin,),\n        size=(field=:Acceleration,),\n    ),\n    graphic = Mark(d)\n)\n\ndraw(new_plt)","category":"page"},{"location":"","page":"Home","title":"Home","text":"We can manipulate our plots and add new diagram elements in order to produce a new visualization:","category":"page"},{"location":"","page":"Home","title":"Home","text":"viz_title = TextMark(text=\"Creating a New Viz\",anchor=:c,fontsize=20)\nviz_frame = S(:fillOpacity=>0,:stroke=>:black)T(400,100)*Rectangle(h=370,w=1000)\n\nnew_viz = new_plt + T(470,0)plt + viz_frame + T(400,250)*viz_title\n\ndraw(new_viz)","category":"page"},{"location":"","page":"Home","title":"Home","text":"Check the documentation for a more thorough exposition.","category":"page"},{"location":"#Installation","page":"Home","title":"Installation","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"To install Vizgrams.jl, run the following command in the Julia REPL:","category":"page"},{"location":"","page":"Home","title":"Home","text":"julia>]\npkg> add Vizagrams","category":"page"},{"location":"#Related-Packages-in-the-Julia-Ecosystem","page":"Home","title":"Related Packages in the Julia Ecosystem","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Compose.jl - A vector graphics library for Julia, that can be used for diagram drawing. Similar to Vizagrams, it is also inspired by the Haskell library Diagrams.\nGadfly.jl - A data visualization package based largely on Hadley Wickhams's ggplot2. It has been developed for many years, thus, it is a good choice for those who want a robust data visualization package with a visualization grammar implementation.\nLuxor.jl - Package for drawing simple static 2D vector graphics. The focus of Luxor is on simplicity and ease of use.\nMakie.jl - Implements an interactive plotting ecosystem. Similar to Python's Matplotlib, it does not implement a visualization grammar, instead, users can pick from a collection of charts and arrange them using layouts and other customization options.\nPlots.jl - A visualization interface and toolset. It does not implement a visualization grammar, instead relying on the concept of plot attributes as the building block of plot specifications.\nVegaLite.jl - Plotting package based on Vega-Lite, which is a high-level grammar of interactive graphics.","category":"page"},{"location":"#Citing","page":"Home","title":"Citing","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"@misc{Vizagrams.jl,\n    author = {Davi Sales Barreira, Asla Medeiros e Sá, Flávio Codeço Coelho},\n    title = {Vizagrams.jl},\n    url = {https://github.com/davibarreira/Vizagrams.jl},\n    version = {v0.1.0},\n    year = {2024},\n    month = {7},\n}","category":"page"},{"location":"#Next-Steps","page":"Home","title":"Next Steps","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"If you are instereted in learning more about Vizagrams, go through the Tutorials secion in the documentation, where we go step-by-step from the basics of diagramming, to more complex visualizations.","category":"page"},{"location":"","page":"Home","title":"Home","text":"","category":"page"},{"location":"","page":"Home","title":"Home","text":"[1]: For example, Gadfly.jl is built on top of Compose.jl and the R pacakge ggplot2 is built on top of grid.","category":"page"},{"location":"","page":"Home","title":"Home","text":"[2]: Check the documentation for an explanation on graphical marks and graphic expressions.","category":"page"},{"location":"tutorials/4_expressiveness/#Graphic-Expressions","page":"4 - Graphic Expressions","title":"Graphic Expressions","text":"","category":"section"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"It is time to move to more complex graphics. This can be achieved through the use of graphic expressions which are contained in the graphic parameter of the plot specification.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"In data visualization, our goal is to represet data as a diagram (drawing) such that we can infer information about the data from the image generated. For this to work, we need a \"sensible\" way of mapping data to graphical marks. This \"sensible\" way of converting data to diagrams is done in Vizagrams through graphic expressions. The idea of a graphic expression is that the way we draw graphics can be divided into three components:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Coalgebra - This describes how to traverse the data, e.g., we can traverse the data row by row, or we can group it by a given column;\nExpression - This is a function that says how to take a portion of the data (e.g. a row) and express it as a diagram;\nAlgebra - This describes how to combine the diagrams produced by each chunk of data.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"The graphic expression can be written in a mathematical notation as:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"beginaligned\n    expr  textDatato textDiagram \n    alg  textDiagramto textDiagram \n    coalg  textDatato textData\nendaligned","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"For those without a mathematical mindset, this might look awfully complicated, but hopefully we can dispel some of the confusion with some examples.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"using Vizagrams\nusing DataFrames\nusing Statistics\nusing Random\nusing VegaDatasets\ndf = DataFrame(dataset(\"cars\"));\n\n# We need to drop missing values, as Vizagrams does not handle them yet.\ndf = dropmissing(df);\n\nnothing #hide","category":"page"},{"location":"tutorials/4_expressiveness/#1.-Scatter-Plots-v.s.-Line-Plots","page":"4 - Graphic Expressions","title":"1. Scatter Plots v.s. Line Plots","text":"","category":"section"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"In a scatter plot, the process of drawing the graphic is distinct from that of a line plot. How so? Suppose we have a dataset with x, y, and color values. For the scatter plot, we traverse the dataset row by row, drawing a circle in position (x,y) with a given color for each row. Hence, the number of circles (or any other mark used to represent a point) will be drawn N times, where N is the number of rows in the dataset. For the line plot, what we actually want is to group the rows in the dataset with the same color value, and then, draw a line with such color passing through all these rows.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"In terms of graphic expressions, for the scatter plot we have:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"    sum_textiterate by row^+ textS(stroke=rowcolor)*textCircle(c=rowxrowy)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"where we iterate over each row, creating a circle mark and then summing them together. Note that the result of the above equation is equal to:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"textS(stroke=data1color)*textCircle(c=data1xdata1y) + \n \n+textS(stroke=dataNcolor)*textCircle(c=dataNxdataNy)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"The idea is that data[n,:x] means picking row n column :x for the dataset.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Now, for the line plot, we have:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"    sum^+_textgroup by colortextS(stroke=rowscolor1)*textLine(rowsxrowsy)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Note that, in this case, we are not iterating over each row, instead, we are grouping the data by the color values. Each iteration contains many rows, thus, rows.x is actually a list of values in column x. Since each iteration has the same value for color, we use rows.color[1] to get a single color value, and use it to color the whole line.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"In Tutorial 3, we have shown how to create scatter plots and line plots simply by picking a mark such as Circle or Line. Under the hood, what Vizagrams was doing was to infer the graphic expressions for such marks. Now, let us instead pass the actual graphic expression:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=>mean,:Miles_per_Gallon=>mean)\n\nplt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n    ),\n    graphic = ∑() do row\n        S(:fill=>row.color)Circle(r=5,c=[row.x,row.y])\n    end\n)\ndraw(plt)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Note that in our graphic parameter we passed:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"∑() do row\n    S(:fill=>row.color)Circle(r=5,c=[row.x,row.y])\nend","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"This is how we write that summation notation for the graphic expression. In the case above, the sum ∑() is doing the job of sum^+_textiterate by row.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Let us now show how to do the lineplot.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"plt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n    ),\n    graphic= ∑(i=:color) do rows\n        S(:stroke=>rows.color[1],:strokeWidth=>3)Line(rows.x,rows.y)\n    end\n)\ndraw(plt)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"This time, we used the following graphic expression:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"∑(i=:color) do rows\n    S(:stroke=>rows.color[1],:strokeWidth=>3)Line(rows.x,rows.y)\nend","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Here, the ∑(i=:color) is how we define that the data must be grouped by :color. The i is to invoke the idea of indexing, in other words, this is a summation where we are indexing the data by the color value.","category":"page"},{"location":"tutorials/4_expressiveness/#2.-Exploring-Graphic-Expressions","page":"4 - Graphic Expressions","title":"2. Exploring Graphic Expressions","text":"","category":"section"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Note that the graphic expressions for the scatter plot and the line plot can easily be modified to produce other plots. Consider, for example, that we wish to create a scatter plot with a Face mark. The specification is almost the same as the one for the scatter plot with circles:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"plt = Plot(\n    title=\"MyPlot\",\n    data=df,\n    encodings=(\n        x = (field = :Horsepower,),\n        y = (field = :Displacement,),\n        color = (field = :Origin, scale_range=:tableau_superfishel_stone),\n        smile = (field = :Cylinders, scale_range=(-1,1),),\n    ),\n    graphic = ∑() do row\n        T(row[:x],row[:y])U(5)Face(headstyle=S(:fill=>row[:color]),smile=row[:smile])\n    end\n)\n\n\ndraw(plt, height=400)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"The graphic expression is very straightforward. We simply iterate over each row, drawing the face mark. Instead of passing the x and y positions to the mark, we are using a translation transformation. We also use the scaling U(5) in order to enlarge the mark.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"∑() do row\n    T(row[:x],row[:y])U(5)Face(headstyle=S(:fill=>row[:color]),smile=row[:smile])\nend","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"For the encoding specification, the main difference is the smile variable.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"smile = (field = :Cylinders, scale_range=(-1,1),),","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"In the specifcation above, we are encoding the data columns Cylinders and applying a linear scaling function where the cylinder values are mapped to values between -1 and 1.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"plt = Plot(\n    config=(xaxis=(ticktextangle=π/2,),),\n    data=gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n    ),\n    graphic= ∑(i=:color) do rows\n        S(:stroke=>rows.color[1],:strokeWidth=>2)*\n        Arrow(rows.x,rows.y,headsize=5,headstyle=S(:fill=>rows.color[1]))\n    end\n)\ndraw(plt)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=>mean,:Miles_per_Gallon=>mean)\n\ngdf = sort(gdf,:Year)\n\nplt = Plot(\n    title=\"MyPlot\",\n    config=(\n            xaxis=(ticktextangle=π/2,),\n            yaxis=(ticktextangle=0,ticktextanchor=:c),\n        ),\n    data = gdf,\n    encodings=(\n        x=(field=:Year,),\n        y=(field=:Horsepower_mean,),\n        color=(field=:Origin,),\n    ),\n    graphic = ∑(i=:color,orderby=:color,descend=false) do row\n        S(:strokeWidth=>5)Area(pts=row.x ⊗ row.y,color=row.color[1])\n    end\n)\n\ndraw(plt)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"gdf = combine(groupby(df,[:Origin]),nrow,)\ngdf = rename(gdf, :nrow=>:Total_Cars);\n\nplt = Plot(\n    data=gdf,\n    encodings=(\n        x=(field=:Origin,),\n        y=(field=:Total_Cars,),\n        text=(field=:Total_Cars,scale=IdScale()),\n    ),\n    graphic= ∑() do row\n        bar = S(:fill=>:steelblue)*Bar(h=row[:y],c=[row[:x],0],w=40)\n        text= TextMark(text=row[:text])\n        return bar ↑ (T(row[:x],5),text)\n    end\n)\ndraw(plt)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"As we have stated, a graphic expression has a coalgebra (how to iterate over the data), an expression (how to turn sections of the data into diagrams) and an algebra (how to combine diagrams). In our previous example, both graphic expressions use the + operator as the algebra. Yet, different operations could be used, such as stacking. For example:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"sum^uparrow_textiterate by row Circle(r=rowsize)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"is equal to","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Circle(r=data1size) uparrow Circle(r=data2size)  uparrow  uparrow Circle(r=dataNsize)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Moreover, we can compose graphic expressions in order to perform a nested iteration. For example,","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"sum^alg = +_i=textxsum^alg=uparrow_j=textcolor expr","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"In this graphic expression, we first group the data by values of :x, then each group if further grouped by values of :color. Think of this as nested for-loops.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"The example we just gave is actually how we can construct stacked bar plots. Note:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"gdf = combine(groupby(df,[:Origin, :Cylinders]),:Miles_per_Gallon=>mean,:Horsepower=>mean);\nplt = Plot(\n    data=gdf,\n    encodings=(\n        x=(field=:Cylinders,),\n        y=(field=:Miles_per_Gallon_mean,scale_domain = (0,100)),\n        color=(field=:Origin,datatype=:n),\n    ),\n    graphic =\n        ∑(i=:x,op=+,\n            ∑(i=:color,op=↑,orderby=:color, descend=false,\n                ∑() do row\n                    S(:fill=>row[:color])Bar(h=row[:y],c=[row[:x],0], w = 40)\n                end\n            )\n        )\n    )\ndraw(plt, height=400)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"The process of drawing the stacked bars can be described as follows:","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Group data by values of x\n    Group data by values of color\n        Iterate over each row drawing bar\n    Stack bars vertically\nSum the stacked bars","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"This process of grouping and combining is exactly what the graphic expression is doing.","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"∑(i=:x,op=+,\n    ∑(i=:color,op=↑,orderby=:color, descend=false,\n        ∑() do row\n            S(:fill=>row[:color])Bar(h=row[:y],c=[row[:x],0], w = 40)\n        end\n    )\n)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"Here is where things start to get interesting. Suppose now we want to add a text with the value of each bar as a label. We can simply increment the previous graphic expression with a","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"gdf = combine(\n    groupby(df, [:Origin, :Cylinders]), :Miles_per_Gallon => mean, :Horsepower => mean\n);\nplt = Plot(;\n    data=gdf,\n    encodings=(\n        x=(field=:Cylinders,),\n        y=(field=:Miles_per_Gallon_mean, scale_domain=(0, 100)),\n        color=(field=:Origin, datatype=:n),\n        text=(field=:Miles_per_Gallon_mean, scale=x -> x),\n    ),\n    graphic=∑(\n        i=:x,\n        op=+,\n        ∑(\n            i=:color,\n            op=↑,\n            orderby=:color,\n            descend=false,\n            ∑() do row\n                S(:fill => row[:color])Bar(; h=row[:y], c=[row[:x], 0], w=40) +\n                S(:fill => :white) * TextMark(;\n                    text=round(row[:text]; digits=1), pos=[row[:x], row[:y] / 2], fontsize=7\n                )\n            end,\n        ),\n    ),\n)\ndraw(plt; height=400)","category":"page"},{"location":"tutorials/4_expressiveness/","page":"4 - Graphic Expressions","title":"4 - Graphic Expressions","text":"gdf = combine(\n    groupby(df, [:Origin, :Cylinders]), :Miles_per_Gallon => mean, :Horsepower => mean\n);\nplt = Plot(;\n    data=gdf,\n    encodings=(\n        x=(field=:Cylinders,),\n        y=(field=:Miles_per_Gallon_mean, scale_domain=(0, 100)),\n        color=(field=:Origin, datatype=:n),\n        text=(field=:Miles_per_Gallon_mean, scale=IdScale()),\n        w=(\n            field=:Horsepower_mean,\n            scale_domain=(75, 160),\n            scale_range=(20, 50),\n            legend=(fmark=x -> Bar(; h=1, w=x),),\n        ),\n        textw=(field=:Horsepower_mean, scale=IdScale()),\n    ),\n    graphic=∑(\n        i=:x,\n        op=+,\n        ∑(\n            i=:color,\n            op=↑,\n            orderby=:color,\n            descend=false,\n            ∑() do row\n                S(:fill => row[:color])Bar(; h=row[:y], c=[row[:x], 0], w=row[:w]) +\n                S(:fill => :white) * TextMark(;\n                    text=round(row[:text]; digits=1),\n                    pos=[row[:x] + row[:w] / 2 - 2, row[:y] / 2],\n                    fontsize=5,\n                    angle=π / 2,\n                    anchor=:s,\n                ) +\n                S(:fill => :white) * TextMark(;\n                    text=round(row[:textw]; digits=1),\n                    pos=[row[:x], 2],\n                    fontsize=5,\n                    anchor=:s,\n                )\n            end,\n        ),\n    ),\n)\ndraw(plt; height=400)","category":"page"},{"location":"tutorials/6_polar/#Polar-Visualizations","page":"6 - Polar Visualizations","title":"Polar Visualizations","text":"","category":"section"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"At the moment, all our plots have used the typical Cartesian coordinates. In this tutorial, we explore data visualizations that use the polar coordinate system.","category":"page"},{"location":"tutorials/6_polar/#1.-Pizza-Plot","page":"6 - Polar Visualizations","title":"1. Pizza Plot","text":"","category":"section"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"Let us start with the very common pizza plot (pie chart). To construct such plot, we must map a data column to angles. Moreover, we need to compute the cumulative angle, in order to rotate the slices by the right amount. Note that this plot does not have any coordinate axes, as we don't use x and y when specifying the pizza.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"The quick way of producing this plot is by using the preset mark Pizza:","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"using Vizagrams\nusing DataFrames\nusing Random\n\nRandom.seed!(4)\ndf = DataFrame(x=[1, 2, 3, 5, 1, 2], y=[10, 10, 20, 10, 20, 30],\n    c=[\"a\", \"b\", \"a\", \"a\", \"b\", \"a\"],d=rand([0,1],6),e=rand([1,2,3],6),\n    k=[\"key1\",\"key2\",\"key3\",\"key4\",\"key5\",\"key6\"]\n)\n\nplt = Plot(\n    figsize=(300,250),\n    data=df,\n    encodings=(\n        color=(field=:k,datatype=:n),\n        angle = (field = :x, datatype=:q, scale_domain=(0,sum(df.x)), scale_range=(0,2π)),\n        r = (field=:y, scale_range=(80,120))\n    ),\n    graphic = Pizza()\n)\n\ndraw(plt)","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"Note that we must adjust the scale for the angle so that the domain goes from 0 to the sum of values of x and ranging from 0 to 2π. We must also adjust the scale for the radius variable r, so that our pizza is large enough compared to the figsize.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"We can replicate the pizza plot using Slice marks instead. This makes the construction process more explicit and allows us to more easily create new types of visualizations.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"plt = Plot(\n    figsize=(300,250),\n    data=df,\n    encodings=(\n        color=(field=:k,datatype=:n),\n        angle = (field = :x, datatype=:q, scale_domain=(0,sum(df.x)), scale_range=(0,2π)),\n        r = (field=:y, scale_range=(80,120)),\n    ),\n    graphic = data -> begin\n        acc = cumsum(vcat(0,getscale(plt,:angle)(df.x)[begin:end-1]))\n        data = hconcat(data,acc=acc)\n        ∑() do row\n            S(:fill=>row.color)Slice(rmajor=row.r,ang=row.angle,θ=row.acc,rminor=20)\n        end(data)\n    end\n)\n\ndraw(plt)","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"Let us explain the graphic expression:","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"graphic = data -> begin\n    acc = cumsum(vcat(0,getscale(plt,:angle)(df.x)[begin:end-1]))\n    acc = StructArray(acc=acc)\n    data = hconcat(data,acc)\n    ∑() do row\n        S(:fill=>row.color)Slice(rmajor=row.r,ang=row.angle,θ=row.acc,rminor=20)\n    end(data)\nend","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"The main hurdle to specify the pizza plot is to compute the cumulative angle. This must be done over the whole dataset, before we draw each slice. To do this, we simply start our graphic expression with data -> .... Then, we compute the cumulative angle, and append it to the data. We then can simply loop over each row drawing the slices.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"The advantage of such approach is that we can now easily add labels. We add a new variable text to our specification, compute the the x and y positions for the labels, and add the TextMark.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"plt = Plot(\n    figsize=(300,250),\n    data=df,\n    encodings=(\n        color=(field=:k,datatype=:n),\n        angle = (field = :x, datatype=:q, scale_domain=(0,sum(df.x)), scale_range=(0,2π)),\n        r = (field=:y, scale_range=(80,120)),\n        text = (field=:y, scale=IdScale()),\n    ),\n    graphic = data -> begin\n        acc = cumsum(vcat(0,getscale(plt,:angle)(df.x)[begin:end-1]))\n        data = hconcat(data,acc=acc)\n        ∑() do row\n            r = row.r + 15\n            x = r*cos(row.acc-π/2+row.angle/2)\n            y = r*sin(row.acc-π/2+row.angle/2)\n            S(:fill=>row.color,:stroke=>:white)Slice(rmajor=row.r,ang=row.angle,θ=row.acc,rminor=20) +\n            S(:fill=>row.color)T(x,y)TextMark(text=row.text,fontsize=8)\n        end(data)\n    end\n)\n\ndraw(plt)","category":"page"},{"location":"tutorials/6_polar/#2.-Radar-Plot","page":"6 - Polar Visualizations","title":"2. Radar Plot","text":"","category":"section"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"Our next examples are radar plots. These are distinct from pizza plots in the sense that they actually use polar coordinates. In order to user polar coordinates in a graphic specification, we must simply pass coordinate = :polar through config. While the Cartesian coordinates require the x and y encoding variables, the polar coordinate requires the radius variable r and the angle. Vizagrams then computes the x and y values automatically, which can be used in graphic expressions.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"Let us first do a simple example.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"plt = Plot(\n    figsize=(300,300),\n    data=df,\n    config=(coordinate=:polar,),\n    encodings=(\n        r = (\n            field=:y,\n            datatype=:q,\n            scale_domain =(0,maximum(df[!,:y])), scale_range=(0,150)),\n        angle = (\n            field=:k,\n            datatype=:n,\n            scale_range=collect(range(0,2π,length=length(unique(df.k))+1))[begin:end-1]\n            ),\n    ),\n    graphic = Polygon() + S(:fill=>:steelblue,:opacity=>1)Circle(r=10)\n);\ndraw(plt)","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"Using the Polygon mark with the Circle mark we can produce the radar plot. Other marks could also be used in order to produce other types of visualizations. In the next example, we change the radius scale range so that the frame resembles a donut. Note that we also use guide=(a_tick_flag=:in,) within the config specification in order place the ticks to be in the inner radius.","category":"page"},{"location":"tutorials/6_polar/","page":"6 - Polar Visualizations","title":"6 - Polar Visualizations","text":"plt = Plot(\n    figsize=(300,300),\n    data=df,\n    config=(\n        guide=(a_tick_flag=:in,),\n        coordinate=:polar,),\n    encodings=(\n        r = (\n            field=:y,\n            datatype=:q,\n            scale_domain =(0,maximum(df[!,:y])+10), scale_range=(70,150)),\n        angle = (\n            field=:k,\n            datatype=:n,\n            scale_range=collect(range(0,2π,length=length(unique(df.k))+1))[begin:end-1]\n            ),\n        color=(field=:d,datatype=:n),\n        size=(field=:e,datatype=:q),\n    ),\n    graphic = Line() + S(:opacity=>1)Circle()\n);\ndraw(plt)","category":"page"}]
}
