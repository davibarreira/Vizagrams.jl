<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>4 - Graphic Expressions · Vizagrams.jl</title><meta name="title" content="4 - Graphic Expressions · Vizagrams.jl"/><meta property="og:title" content="4 - Graphic Expressions · Vizagrams.jl"/><meta property="twitter:title" content="4 - Graphic Expressions · Vizagrams.jl"/><meta name="description" content="Documentation for Vizagrams.jl."/><meta property="og:description" content="Documentation for Vizagrams.jl."/><meta property="twitter:description" content="Documentation for Vizagrams.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Vizagrams.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Vizagrams.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../1_basics/">1 - Diagramming Basics</a></li><li><a class="tocitem" href="../2_custommarks/">2 - Custom Marks</a></li><li><a class="tocitem" href="../3_datavisualization/">3 - Data Vizualization Basics</a></li><li class="is-active"><a class="tocitem" href>4 - Graphic Expressions</a><ul class="internal"><li><a class="tocitem" href="#1.-Scatter-Plots-v.s.-Line-Plots"><span>1. Scatter Plots v.s. Line Plots</span></a></li><li><a class="tocitem" href="#2.-Exploring-Graphic-Expressions"><span>2. Exploring Graphic Expressions</span></a></li></ul></li><li><a class="tocitem" href="../5_customization/">5 - Customizing Visualizations</a></li><li><a class="tocitem" href="../6_polar/">6 - Polar Visualizations</a></li><li><a class="tocitem" href="../7_composite/">7 - Composite Visualizations</a></li></ul></li><li><span class="tocitem">Gallery</span><ul><li><a class="tocitem" href="../../gallery/boxplot/">BoxPlot</a></li><li><a class="tocitem" href="../../gallery/groupedbar/">Grouped Bar Chart</a></li><li><a class="tocitem" href="../../gallery/histogram/">Histogram</a></li><li><a class="tocitem" href="../../gallery/minard/">Minard&#39;s Chart</a></li><li><a class="tocitem" href="../../gallery/moritz/">OECD Better Life Index</a></li><li><a class="tocitem" href="../../gallery/pca/">PCA</a></li><li><a class="tocitem" href="../../gallery/penguins/">Penguins</a></li><li><a class="tocitem" href="../../gallery/nightingale/">Rose Diagram</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>4 - Graphic Expressions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>4 - Graphic Expressions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/davibarreira/Vizagrams.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/davibarreira/Vizagrams.jl/blob/master/docs/src/tutorials/4_expressiveness.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Graphic-Expressions"><a class="docs-heading-anchor" href="#Graphic-Expressions">Graphic Expressions</a><a id="Graphic-Expressions-1"></a><a class="docs-heading-anchor-permalink" href="#Graphic-Expressions" title="Permalink"></a></h1><p>It is time to move to more complex graphics. This can be achieved through the use of graphic expressions which are contained in the <code>graphic</code> parameter of the plot specification.</p><p>In data visualization, our goal is to represet data as a diagram (drawing) such that we can infer information about the data from the image generated. For this to work, we need a &quot;sensible&quot; way of mapping data to graphical marks. This &quot;sensible&quot; way of converting data to diagrams is done in Vizagrams through <em>graphic expressions</em>. The idea of a graphic expression is that the way we draw graphics can be divided into three components:</p><ul><li><p>Coalgebra - This describes how to traverse the data, e.g., we can traverse the data row by row, or we can group it by a given column;</p></li><li><p>Expression - This is a function that says how to take a portion of the data (e.g. a row) and express it as a diagram;</p></li><li><p>Algebra - This describes how to combine the diagrams produced by each chunk of data.</p></li></ul><p>The graphic expression can be written in a mathematical notation as:</p><p class="math-container">\[\begin{aligned}
    &amp;expr : \text{Data}\to \text{Diagram} \\
    &amp;alg : \text{[Diagram]}\to \text{Diagram} \\
    &amp;coalg : \text{Data}\to \text{[Data]}
\end{aligned}\]</p><p>For those without a mathematical mindset, this might look awfully complicated, but hopefully we can dispel some of the confusion with some examples.</p><pre><code class="language-julia hljs">using Vizagrams
using DataFrames
using Statistics
using Random
using VegaDatasets
df = DataFrame(dataset(&quot;cars&quot;));

# We need to drop missing values, as Vizagrams does not handle them yet.
df = dropmissing(df);</code></pre><h2 id="1.-Scatter-Plots-v.s.-Line-Plots"><a class="docs-heading-anchor" href="#1.-Scatter-Plots-v.s.-Line-Plots">1. Scatter Plots v.s. Line Plots</a><a id="1.-Scatter-Plots-v.s.-Line-Plots-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Scatter-Plots-v.s.-Line-Plots" title="Permalink"></a></h2><p>In a scatter plot, the process of drawing the graphic is distinct from that of a line plot. How so? Suppose we have a dataset with x, y, and color values. For the scatter plot, we traverse the dataset row by row, drawing a circle in position (x,y) with a given color for each row. Hence, the number of circles (or any other mark used to represent a point) will be drawn N times, where N is the number of rows in the dataset. For the line plot, what we actually want is to group the rows in the dataset with the same color value, and then, draw a line with such color passing through all these rows.</p><p>In terms of graphic expressions, for the scatter plot we have:</p><p class="math-container">\[    \sum_{\text{iterate by row}}^{+} \text{S(:stroke=&gt;row.color)}*\text{Circle(c=[row.x,row.y])},\]</p><p>where we iterate over each row, creating a circle mark and then summing them together. Note that the result of the above equation is equal to:</p><p class="math-container">\[\text{S(:stroke=&gt;data[1,:color])}*\text{Circle(c=[data[1,:x],data[1,y])} + \\
... \\
+\text{S(:stroke=&gt;data[N,:color])}*\text{Circle(c=[data[N,:x],data[N,y])}\]</p><p>The idea is that <code>data[n,:x]</code> means picking row <code>n</code> column <code>:x</code> for the dataset.</p><p>Now, for the line plot, we have:</p><p class="math-container">\[    \sum^{+}_{\text{group by color}}\text{S(:stroke=&gt;rows.color[1])}*\text{Line(rows.x,rows.y)}.\]</p><p>Note that, in this case, we are not iterating over each row, instead, we are grouping the data by the color values. Each iteration contains many rows, thus, <code>rows.x</code> is actually a list of values in column <code>x</code>. Since each iteration has the same value for color, we use <code>rows.color[1]</code> to get a single color value, and use it to color the whole line.</p><p>In Tutorial 3, we have shown how to create scatter plots and line plots simply by picking a mark such as <code>Circle</code> or <code>Line</code>. Under the hood, what Vizagrams was doing was to infer the graphic expressions for such marks. Now, let us instead pass the actual graphic expression:</p><pre><code class="language-julia hljs">gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=&gt;mean,:Miles_per_Gallon=&gt;mean)

plt = Plot(
    config=(xaxis=(ticktextangle=π/2,),),
    data=gdf,
    encodings=(
        x=(field=:Year,),
        y=(field=:Horsepower_mean,),
        color=(field=:Origin,),
    ),
    graphic = ∑() do row
        S(:fill=&gt;row.color)Circle(r=5,c=[row.x,row.y])
    end
)
draw(plt)</code></pre><img src="ed907d26.svg" alt="Example block output"/><p>Note that in our <code>graphic</code> parameter we passed:</p><pre><code class="language-julia hljs">∑() do row
    S(:fill=&gt;row.color)Circle(r=5,c=[row.x,row.y])
end</code></pre><p>This is how we write that summation notation for the graphic expression. In the case above, the sum <code>∑()</code> is doing the job of <span>$\sum^{+}_{\text{iterate by row}}$</span>.</p><p>Let us now show how to do the lineplot.</p><pre><code class="language-julia hljs">plt = Plot(
    config=(xaxis=(ticktextangle=π/2,),),
    data=gdf,
    encodings=(
        x=(field=:Year,),
        y=(field=:Horsepower_mean,),
        color=(field=:Origin,),
    ),
    graphic= ∑(i=:color) do rows
        S(:stroke=&gt;rows.color[1],:strokeWidth=&gt;3)Line(rows.x,rows.y)
    end
)
draw(plt)</code></pre><img src="7b668434.svg" alt="Example block output"/><p>This time, we used the following graphic expression:</p><pre><code class="language-julia hljs">∑(i=:color) do rows
    S(:stroke=&gt;rows.color[1],:strokeWidth=&gt;3)Line(rows.x,rows.y)
end</code></pre><p>Here, the <code>∑(i=:color)</code> is how we define that the data must be grouped by <code>:color</code>. The <code>i</code> is to invoke the idea of indexing, in other words, this is a summation where we are indexing the data by the color value.</p><h2 id="2.-Exploring-Graphic-Expressions"><a class="docs-heading-anchor" href="#2.-Exploring-Graphic-Expressions">2. Exploring Graphic Expressions</a><a id="2.-Exploring-Graphic-Expressions-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Exploring-Graphic-Expressions" title="Permalink"></a></h2><p>Note that the graphic expressions for the scatter plot and the line plot can easily be modified to produce other plots. Consider, for example, that we wish to create a scatter plot with a <code>Face</code> mark. The specification is almost the same as the one for the scatter plot with circles:</p><pre><code class="language-julia hljs">plt = Plot(
    title=&quot;MyPlot&quot;,
    data=df,
    encodings=(
        x = (field = :Horsepower,),
        y = (field = :Displacement,),
        color = (field = :Origin, scale_range=:tableau_superfishel_stone),
        smile = (field = :Cylinders, scale_range=(-1,1),),
    ),
    graphic = ∑() do row
        T(row[:x],row[:y])U(5)Face(headstyle=S(:fill=&gt;row[:color]),smile=row[:smile])
    end
)


draw(plt, height=400)</code></pre><img src="81e681de.svg" alt="Example block output"/><p>The graphic expression is very straightforward. We simply iterate over each row, drawing the face mark. Instead of passing the x and y positions to the mark, we are using a translation transformation. We also use the scaling <code>U(5)</code> in order to enlarge the mark.</p><pre><code class="language-julia hljs">∑() do row
    T(row[:x],row[:y])U(5)Face(headstyle=S(:fill=&gt;row[:color]),smile=row[:smile])
end</code></pre><p>For the encoding specification, the main difference is the <code>smile</code> variable.</p><pre><code class="language-julia hljs">smile = (field = :Cylinders, scale_range=(-1,1),),</code></pre><p>In the specifcation above, we are encoding the data columns <code>Cylinders</code> and applying a linear scaling function where the cylinder values are mapped to values between -1 and 1.</p><pre><code class="language-julia hljs">plt = Plot(
    config=(xaxis=(ticktextangle=π/2,),),
    data=gdf,
    encodings=(
        x=(field=:Year,),
        y=(field=:Horsepower_mean,),
        color=(field=:Origin,),
    ),
    graphic= ∑(i=:color) do rows
        S(:stroke=&gt;rows.color[1],:strokeWidth=&gt;2)*
        Arrow(rows.x,rows.y,headsize=5,headstyle=S(:fill=&gt;rows.color[1]))
    end
)
draw(plt)</code></pre><img src="a17cd727.svg" alt="Example block output"/><pre><code class="language-julia hljs">gdf = combine(groupby(df,[:Year,:Origin]),:Horsepower=&gt;mean,:Miles_per_Gallon=&gt;mean)

gdf = sort(gdf,:Year)

plt = Plot(
    title=&quot;MyPlot&quot;,
    config=(
            xaxis=(ticktextangle=π/2,),
            yaxis=(ticktextangle=0,ticktextanchor=:c),
        ),
    data = gdf,
    encodings=(
        x=(field=:Year,),
        y=(field=:Horsepower_mean,),
        color=(field=:Origin,),
    ),
    graphic = ∑(i=:color,orderby=:color,descend=false) do row
        S(:strokeWidth=&gt;5)Area(pts=row.x ⊗ row.y,color=row.color[1])
    end
)

draw(plt)</code></pre><img src="c13d6f38.svg" alt="Example block output"/><pre><code class="language-julia hljs">gdf = combine(groupby(df,[:Origin]),nrow,)
gdf = rename(gdf, :nrow=&gt;:Total_Cars);

plt = Plot(
    data=gdf,
    encodings=(
        x=(field=:Origin,),
        y=(field=:Total_Cars,),
        text=(field=:Total_Cars,scale=IdScale()),
    ),
    graphic= ∑() do row
        bar = S(:fill=&gt;:steelblue)*Bar(h=row[:y],c=[row[:x],0],w=40)
        text= TextMark(text=row[:text])
        return bar ↑ (T(row[:x],5),text)
    end
)
draw(plt)</code></pre><img src="d9d8d06c.svg" alt="Example block output"/><p>As we have stated, a graphic expression has a coalgebra (how to iterate over the data), an expression (how to turn sections of the data into diagrams) and an algebra (how to combine diagrams). In our previous example, both graphic expressions use the <code>+</code> operator as the algebra. Yet, different operations could be used, such as stacking. For example:</p><p class="math-container">\[\sum^{\uparrow}_{\text{iterate by row}} Circle(r=row.size)\]</p><p>is equal to</p><p class="math-container">\[Circle(r=data[1,:size]) \uparrow Circle(r=data[2,:size])  \uparrow ... \uparrow Circle(r=data[N,:size]).\]</p><p>Moreover, we can compose graphic expressions in order to perform a nested iteration. For example,</p><p class="math-container">\[\sum^{alg = +}_{i=\text{:x}}\sum^{alg=\uparrow}_{j=\text{:color}} expr\]</p><p>In this graphic expression, we first group the data by values of <code>:x</code>, then each group if further grouped by values of <code>:color</code>. Think of this as nested for-loops.</p><p>The example we just gave is actually how we can construct stacked bar plots. Note:</p><pre><code class="language-julia hljs">gdf = combine(groupby(df,[:Origin, :Cylinders]),:Miles_per_Gallon=&gt;mean,:Horsepower=&gt;mean);
plt = Plot(
    data=gdf,
    encodings=(
        x=(field=:Cylinders,),
        y=(field=:Miles_per_Gallon_mean,scale_domain = (0,100)),
        color=(field=:Origin,datatype=:n),
    ),
    graphic =
        ∑(i=:x,op=+,
            ∑(i=:color,op=↑,orderby=:color, descend=false,
                ∑() do row
                    S(:fill=&gt;row[:color])Bar(h=row[:y],c=[row[:x],0], w = 40)
                end
            )
        )
    )
draw(plt, height=400)</code></pre><img src="698d1112.svg" alt="Example block output"/><p>The process of drawing the stacked bars can be described as follows:</p><pre><code class="nohighlight hljs">Group data by values of x
    Group data by values of color
        Iterate over each row drawing bar
    Stack bars vertically
Sum the stacked bars</code></pre><p>This process of grouping and combining is exactly what the graphic expression is doing.</p><pre><code class="language-julia hljs">∑(i=:x,op=+,
    ∑(i=:color,op=↑,orderby=:color, descend=false,
        ∑() do row
            S(:fill=&gt;row[:color])Bar(h=row[:y],c=[row[:x],0], w = 40)
        end
    )
)</code></pre><p>Here is where things start to get interesting. Suppose now we want to add a text with the value of each bar as a label. We can simply increment the previous graphic expression with a</p><pre><code class="language-julia hljs">gdf = combine(
    groupby(df, [:Origin, :Cylinders]), :Miles_per_Gallon =&gt; mean, :Horsepower =&gt; mean
);
plt = Plot(;
    data=gdf,
    encodings=(
        x=(field=:Cylinders,),
        y=(field=:Miles_per_Gallon_mean, scale_domain=(0, 100)),
        color=(field=:Origin, datatype=:n),
        text=(field=:Miles_per_Gallon_mean, scale=x -&gt; x),
    ),
    graphic=∑(
        i=:x,
        op=+,
        ∑(
            i=:color,
            op=↑,
            orderby=:color,
            descend=false,
            ∑() do row
                S(:fill =&gt; row[:color])Bar(; h=row[:y], c=[row[:x], 0], w=40) +
                S(:fill =&gt; :white) * TextMark(;
                    text=round(row[:text]; digits=1), pos=[row[:x], row[:y] / 2], fontsize=7
                )
            end,
        ),
    ),
)
draw(plt; height=400)</code></pre><img src="c6ab4ecc.svg" alt="Example block output"/><pre><code class="language-julia hljs">gdf = combine(
    groupby(df, [:Origin, :Cylinders]), :Miles_per_Gallon =&gt; mean, :Horsepower =&gt; mean
);
plt = Plot(;
    data=gdf,
    encodings=(
        x=(field=:Cylinders,),
        y=(field=:Miles_per_Gallon_mean, scale_domain=(0, 100)),
        color=(field=:Origin, datatype=:n),
        text=(field=:Miles_per_Gallon_mean, scale=IdScale()),
        w=(
            field=:Horsepower_mean,
            scale_domain=(75, 160),
            scale_range=(20, 50),
            legend=(fmark=x -&gt; Bar(; h=1, w=x),),
        ),
        textw=(field=:Horsepower_mean, scale=IdScale()),
    ),
    graphic=∑(
        i=:x,
        op=+,
        ∑(
            i=:color,
            op=↑,
            orderby=:color,
            descend=false,
            ∑() do row
                S(:fill =&gt; row[:color])Bar(; h=row[:y], c=[row[:x], 0], w=row[:w]) +
                S(:fill =&gt; :white) * TextMark(;
                    text=round(row[:text]; digits=1),
                    pos=[row[:x] + row[:w] / 2 - 2, row[:y] / 2],
                    fontsize=5,
                    angle=π / 2,
                    anchor=:s,
                ) +
                S(:fill =&gt; :white) * TextMark(;
                    text=round(row[:textw]; digits=1),
                    pos=[row[:x], 2],
                    fontsize=5,
                    anchor=:s,
                )
            end,
        ),
    ),
)
draw(plt; height=400)</code></pre><img src="3a886008.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3_datavisualization/">« 3 - Data Vizualization Basics</a><a class="docs-footer-nextpage" href="../5_customization/">5 - Customizing Visualizations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 26 September 2024 00:55">Thursday 26 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
